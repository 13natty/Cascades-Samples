<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- orientation.qdoc -->
  <title>Cascades : Orientation Example</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
<li><a href="http://qt.nokia.com/doc/4.7/all-examples.html">Examples</a></li>
<li>Orientation Example</li>
    </ul>
  </div>
</div>
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#the-ui">The UI</a></li>
<li class="level1"><a href="#orientationsensor">OrientationSensor</a></li>
</ul>
</div>
<h1 class="title">Orientation Example</h1>
<span class="subtitle"></span>
<!-- $$$orientation-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="orientation-assets-main-qml.html">orientation/assets/main.qml</a></li>
<li><a href="orientation-src-orientationsensor-cpp.html">orientation/src/OrientationSensor.cpp</a></li>
<li><a href="orientation-src-orientationsensor-hpp.html">orientation/src/OrientationSensor.hpp</a></li>
<li><a href="orientation-src-main-cpp.html">orientation/src/main.cpp</a></li>
<li><a href="orientation-orientation-pro.html">orientation/orientation.pro</a></li>
<li><a href="orientation-translations-orientation-pro.html">orientation/translations/orientation.pro</a></li>
</ul>
<a name="description"></a>
<h2>Description</h2>
<p>The Orientation example demonstrates how to use sensors from the QtSensors module to find out about the current orientation of the device.</p>
<p class="centerAlign"><img src="images/orientation-example.png" /></p><a name="overview"></a>
<h2>Overview</h2>
<p>In this example we'll learn how to use the QOrientationSensor, QOrientationFilter and QOrientationReading classes to retrieve the current orientation from the orientation sensor of the device. Depending of the current orientation we show a different text in the UI.</p>
<a name="the-ui"></a>
<h2>The UI</h2>
<p>The UI of this sample application is really simple and just consists of a <tt>Label</tt> that shows the current orientation as text.</p>
<p>The business logic of the application is encapsulated in the <tt>OrientationSensor</tt> class which is made available to the UI under the name '_sensor'.</p>
<pre class="qml">            <span class="type">Label</span> {
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>

                <span class="comment">// Use a different text depending on current orientation</span>
                <span class="name">text</span>: <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">TopUp</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Top Up&quot;</span>) :
                      <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">TopDown</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Top Down&quot;</span>) :
                      <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">LeftUp</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Left Up&quot;</span>) :
                      <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">RightUp</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Right Up&quot;</span>) :
                      <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">FaceUp</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Face Up&quot;</span>) :
                      <span class="name">_sensor</span>.<span class="name">orientation</span> <span class="operator">==</span> <span class="name">OrientationSensor</span>.<span class="name">FaceDown</span> ? <span class="name">qsTr</span> (<span class="string">&quot;Face Down&quot;</span>) : <span class="string">&quot;&quot;</span>

                <span class="type">textStyle</span> {
                    <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">BigText</span>
                    <span class="name">color</span>: <span class="name">Color</span>.<span class="name">White</span>
                    <span class="name">fontWeight</span>: <span class="name">FontWeight</span>.<span class="name">Bold</span>
                }

                <span class="name">scaleX</span>: <span class="number">0</span>
                <span class="name">scaleY</span>: <span class="number">0</span>

                <span class="name">animations</span>: <span class="name">ScaleTransition</span> {
                    <span class="name">id</span>: <span class="name">animation</span>

                    <span class="name">fromX</span>: <span class="number">0</span>
                    <span class="name">fromY</span>: <span class="number">0</span>
                    <span class="name">toX</span>: <span class="number">1.5</span>
                    <span class="name">toY</span>: <span class="number">1.5</span>
                }
            }</pre>
<p>The text property of the <tt>Label</tt> is bound against the 'orientation' property of the <tt>OrientationSensor</tt> object, so that it is updated automatically whenever the orientation changes. To make it a bit more fancy we use a zoom-in animation when changing the text.</p>
<pre class="qml">            <span class="comment">// Trigger the animation whenever the orientation has changed</span>
            <span class="name">onCreationCompleted</span>: <span class="name">_sensor</span>.<span class="name">orientationChanged</span>.<span class="name">connect</span>(<span class="name">animation</span>.<span class="name">play</span>)</pre>
<p>To execute the animation at the right time we connect the orientationChanged() signal of the <tt>OrientationSensor</tt> against the play() function of the <tt>ScaleTransition</tt>.</p>
<a name="orientationsensor"></a>
<h2>OrientationSensor</h2>
<p>The <tt>OrientationSensor</tt> class encapsulates the business logic of the application. It contains a QOrientationSensor object, which does the low-level communication with the orientation sensor of the device, and provides a property 'orientation' to make the current orientation value available to the UI. It inherits from QOrientationFilter and reimplements the 'bool filter(QOrientationReading*)' method to retrieve the sensor data from the QOrientationSensor object.</p>
<pre class="cpp">    <span class="keyword">class</span> OrientationSensor : <span class="keyword">public</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">,</span> <span class="type">QOrientationFilter</span>
    {
        Q_OBJECT

        <span class="comment">// The property to access the orientation value of the sensor</span>
        Q_PROPERTY(Orientation orientation READ orientation NOTIFY orientationChanged)

    <span class="keyword">public</span>:
        <span class="keyword">enum</span> Orientation {
            Undefined <span class="operator">=</span> <span class="number">0</span><span class="operator">,</span>
            TopUp<span class="operator">,</span>
            TopDown<span class="operator">,</span>
            LeftUp<span class="operator">,</span>
            RightUp<span class="operator">,</span>
            FaceUp<span class="operator">,</span>
            FaceDown
        };
        Q_ENUMS(Orientation);

        OrientationSensor(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> <span class="number">0</span>);

        <span class="comment">// The accessor method for the orientation property</span>
        Orientation orientation() <span class="keyword">const</span>;

    Q_SIGNALS:
        <span class="comment">// The change notification signal of the orientation property</span>
        <span class="type">void</span> orientationChanged();

    <span class="keyword">protected</span>:
        <span class="comment">/**
         * This method is reimplemented from the QOrientationFilter interface and is
         * called by the QOrientationFilter whenever new values are available.
         */</span>
        <span class="type">bool</span> filter(<span class="type">QOrientationReading</span> <span class="operator">*</span>reading);

    <span class="keyword">private</span>:
        <span class="comment">// The orientation sensor</span>
        <span class="type">QOrientationSensor</span> m_sensor;

        <span class="comment">// The orientation value</span>
        Orientation m_orientation;
    };</pre>
<p>Inside the constructor we try to connect the QOrientationSensor object to the hardware backend. If that's successful, we register the <tt>OrientationSensor</tt> class as filter for the QOrientationSensor object and start the sensor to gather data.</p>
<pre class="cpp">    OrientationSensor<span class="operator">::</span>OrientationSensor(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent)
        : <span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span>(parent)
        <span class="operator">,</span> m_orientation(Undefined)
    {

        <span class="comment">// At first we have to connect to the sensor backend...</span>
        <span class="keyword">if</span> (<span class="operator">!</span>m_sensor<span class="operator">.</span>connectToBackend()) {
            <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qWarning">qWarning</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;Cannot connect to orientation sensor backend!&quot;</span>;
        }

        <span class="comment">// ... and then add a filter that will process the read data</span>
        m_sensor<span class="operator">.</span>addFilter(<span class="keyword">this</span>);

        <span class="comment">// Start gathering the data</span>
        m_sensor<span class="operator">.</span>start();
    }</pre>
<p>The 'bool filter(QOrientationReading*)' method is called whenever the QOrientationSensor object retrieved new data from the hardware sensor. Inside this method we simply map the sensor values to our property and notify the UI about possible changes.</p>
<pre class="cpp">    <span class="type">bool</span> OrientationSensor<span class="operator">::</span>filter(<span class="type">QOrientationReading</span> <span class="operator">*</span>reading)
    {
        <span class="comment">// Store the previous orientation</span>
        <span class="keyword">const</span> Orientation oldOrientation <span class="operator">=</span> m_orientation;

        <span class="keyword">switch</span> (reading<span class="operator">-</span><span class="operator">&gt;</span>orientation()) {
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>Undefined:
            m_orientation <span class="operator">=</span> Undefined;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>TopUp:
            m_orientation <span class="operator">=</span> TopUp;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>TopDown:
            m_orientation <span class="operator">=</span> TopDown;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>LeftUp:
            m_orientation <span class="operator">=</span> LeftUp;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>RightUp:
            m_orientation <span class="operator">=</span> RightUp;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>FaceUp:
            m_orientation <span class="operator">=</span> FaceUp;
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="type">QOrientationReading</span><span class="operator">::</span>FaceDown:
            m_orientation <span class="operator">=</span> FaceDown;
            <span class="keyword">break</span>;
        }

        <span class="comment">// Emit changed signal if orientation has changed</span>
        <span class="keyword">if</span> (m_orientation <span class="operator">!</span><span class="operator">=</span> oldOrientation)
            <span class="keyword">emit</span> orientationChanged();

        <span class="comment">// Do no further processing of the sensor data</span>
        <span class="keyword">return</span> <span class="keyword">false</span>;
    }</pre>
</div>
<!-- @@@orientation -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
