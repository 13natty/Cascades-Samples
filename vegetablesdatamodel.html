<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- vegetablesdatamodel.qdoc -->
  <title>Cascades : Vegetables DataModel Example</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
<li><a href="http://qt.nokia.com/doc/4.7/all-examples.html">Examples</a></li>
<li>Vegetables DataModel Example</li>
    </ul>
  </div>
</div>
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#the-ui">The UI</a></li>
<li class="level1"><a href="#the-vegetablesdatamodel">The VegetablesDataModel</a></li>
</ul>
</div>
<h1 class="title">Vegetables DataModel Example</h1>
<span class="subtitle"></span>
<!-- $$$vegetablesdatamodel-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="vegetablesdatamodel-assets-main-qml.html">vegetablesdatamodel/assets/main.qml</a></li>
<li><a href="vegetablesdatamodel-src-vegetablesdatamodel-cpp.html">vegetablesdatamodel/src/vegetablesdatamodel.cpp</a></li>
<li><a href="vegetablesdatamodel-src-vegetablesdatamodel-hpp.html">vegetablesdatamodel/src/vegetablesdatamodel.hpp</a></li>
<li><a href="vegetablesdatamodel-src-main-cpp.html">vegetablesdatamodel/src/main.cpp</a></li>
<li><a href="vegetablesdatamodel-vegetablesdatamodel-pro.html">vegetablesdatamodel/vegetablesdatamodel.pro</a></li>
<li><a href="vegetablesdatamodel-translations-vegetablesdatamodel-pro.html">vegetablesdatamodel/translations/vegetablesdatamodel.pro</a></li>
</ul>
<a name="description"></a>
<h2>Description</h2>
<p>The Vegetables DataModel example demonstrates how to implement a custom DataModel.</p>
<p class="centerAlign"><img src="images/vegetablesdatamodel-example.png" /></p><a name="overview"></a>
<h2>Overview</h2>
<p>In this example we'll learn how to implement a custom, hierarchical <tt>DataModel</tt> that shows a list of vegetables grouped by their color.</p>
<a name="the-ui"></a>
<h2>The UI</h2>
<p>The UI of this sample application consists of a <tt>ListView</tt> that simply shows the content of our custom model.</p>
<p>We create the model in C++ and export it to QML, under the name '_model', as context property inside the main.cpp function.</p>
<pre class="cpp">        QmlDocument <span class="operator">*</span>qml <span class="operator">=</span> QmlDocument<span class="operator">::</span>create(<span class="string">&quot;asset:///main.qml&quot;</span>)<span class="operator">.</span>parent(<span class="operator">&amp;</span>app);
        qml<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(<span class="string">&quot;_model&quot;</span><span class="operator">,</span> <span class="keyword">new</span> VegetablesDataModel(<span class="operator">&amp;</span>app));</pre>
<p>Inside the main QML document, we simply bind this exported property against the 'dataModel' property of the <tt>ListView</tt>.</p>
<pre class="qml">            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a></span> {
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>

                <span class="name">dataModel</span>: <span class="name">_model</span>
            }</pre>
<a name="the-vegetablesdatamodel"></a>
<h2>The VegetablesDataModel</h2>
<p>The data we want to represent with our model look like the following</p>
<pre class="cpp">    <span class="operator">-</span> Green
        <span class="operator">-</span> Cucumber
        <span class="operator">-</span> Peas
        <span class="operator">-</span> Salad
    <span class="operator">-</span> Red
        <span class="operator">-</span> Tomato
        <span class="operator">-</span> Red Radish
        <span class="operator">-</span> Carrot
    <span class="operator">-</span> Yellow
        <span class="operator">-</span> Corn
        <span class="operator">-</span> Paprika</pre>
<p>So we have three top-level entries (the colors) and 3, 3 and 2 second-level entries (the vegetables). By default the <tt>ListView</tt> interprets the top-level entries of a model as headers and the second-level entries as normal items. This behavior can be modified by defining an item type though.</p>
<p>Like any data model in Cascades, our model must inherit from the abstract class <tt>bb::cascades::DataModel</tt> and reimplement the abstract methods.</p>
<pre class="cpp">    <span class="keyword">class</span> VegetablesDataModel : <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel
    {
        Q_OBJECT
    <span class="keyword">public</span>:
        VegetablesDataModel(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> <span class="number">0</span>);

        <span class="comment">// Required interface implementation</span>
        <span class="keyword">virtual</span> <span class="type">int</span> childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);
        <span class="keyword">virtual</span> <span class="type">bool</span> hasChildren(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);
    };</pre>
<p>Inside the constructor we just pass the parent parameter to the constructor of our base class, so that the model can be part of an <a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a> tree.</p>
<pre class="cpp">    VegetablesDataModel<span class="operator">::</span>VegetablesDataModel(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent)
        : bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel(parent)
    {
    }</pre>
<p>The first abstract method we have to reimplement is childCount(), which is called by the <tt>ListView</tt> to find out how many child items a certain parent item in the model has. The passed 'indexPath' parameter specifies the parent item.</p>
<p>If the length of the 'indexPath' is 0 (that means an empty indexPath has been passed), we return the number of top-level items in our model (which is '3' for the three colors). Otherwise if the length of the 'indexPath' is 1 (that means the <tt>ListView</tt> asks for the number of child items for a top-level item), we return the number of second-level items, depending on the parent item.</p>
<pre class="cpp">    <span class="type">int</span> VegetablesDataModel<span class="operator">::</span>childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath)
    {
        <span class="comment">/**
         * In this very simple data model, the first two headers has 3 children
         * and the third one has 2.
         */</span>
        <span class="keyword">const</span> <span class="type">int</span> level <span class="operator">=</span> indexPath<span class="operator">.</span>size();

        <span class="keyword">if</span> (level <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span>) { <span class="comment">// The number of top-level items is requested</span>
            <span class="keyword">return</span> <span class="number">3</span>; <span class="comment">// headers &quot;Green&quot;, &quot;Red&quot; and &quot;Yellow&quot;</span>
        }

        <span class="keyword">if</span> (level <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>) { <span class="comment">// The number of child items for a header is requested</span>
            <span class="keyword">const</span> <span class="type">int</span> header <span class="operator">=</span> indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toInt();

            <span class="keyword">if</span> (header <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span> <span class="operator">|</span><span class="operator">|</span> header <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>) <span class="comment">// &quot;Green&quot; or &quot;Red&quot;</span>
                <span class="keyword">return</span> <span class="number">3</span>;
            <span class="keyword">else</span> <span class="comment">// &quot;Yellow&quot;</span>
                <span class="keyword">return</span> <span class="number">2</span>;
        }

        <span class="comment">// The number of child items for 2nd level items is requested -&gt; always 0</span>
        <span class="keyword">return</span> <span class="number">0</span>;
    }</pre>
<p>Sometimes the <tt>ListView</tt> only wants to know whether an item has child items or not and is not interested in the actual number of child items. In this case it calls the hasChildren() method on the model.</p>
<p>The implementation is straight forward in our example, since all top-level items have children. So we return 'true' if hasChildren() is called on a top-level item and 'false' in all other cases.</p>
<pre class="cpp">    <span class="type">bool</span> VegetablesDataModel<span class="operator">::</span>hasChildren(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath)
    {
        <span class="comment">// Performance is not an issue with this data model.</span>
        <span class="comment">// So just let childCount tell us if we have children.</span>
        <span class="keyword">return</span> childCount(indexPath) <span class="operator">&gt;</span> <span class="number">0</span>;
    }</pre>
<p>Since the <tt>ListView</tt> can use different visual representations for the different types of items (e.g&#x2e; headers and normal items), our model has to tell the <tt>ListView</tt> which item is of which type. This is done by reimplementing the itemType() method. Depending on the length of the passed 'indexPath' we simply return the strings &quot;header&quot; for top-level items and &quot;item&quot; for second-level items.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> VegetablesDataModel<span class="operator">::</span>itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath)
    {
        <span class="keyword">switch</span> (indexPath<span class="operator">.</span>size()) {
            <span class="keyword">case</span> <span class="number">0</span>:
                <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>();
                <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="number">1</span>:
                <span class="keyword">return</span> QLatin1String(<span class="string">&quot;header&quot;</span>);
                <span class="keyword">break</span>;
            <span class="keyword">default</span>:
                <span class="keyword">return</span> QLatin1String(<span class="string">&quot;item&quot;</span>);
                <span class="keyword">break</span>;
        }
    }</pre>
<p>While the previous methods are called by the <tt>ListView</tt> to determine the structure of the model, the data() method is called to retrieve the actual data. An 'indexPath' parameter is passed again to specify the actual item the data shall be retrieved for. Normally you would use this index path to look up the data in some internal objects where you keep your data. In this example however the code is quite verbose to show in detail how to return the right data depending on the passed 'indexPath'.</p>
<p>So if the size of the 'indexPath' is 1, the data of a top-level item are requested. So depending on the actual value of the first 'indexPath' component, we return the color as string. If the size of the 'indexPath' is 2, the data of a second-level item are requested. Now we use a nested switch statement to cover all possible 'indexPath' values.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> VegetablesDataModel<span class="operator">::</span>data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath)
    {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> value;

        <span class="keyword">if</span> (indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>) { <span class="comment">// Header requested</span>
            <span class="keyword">switch</span> (indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toInt()) {
                <span class="keyword">case</span> <span class="number">0</span>:
                    value <span class="operator">=</span> tr(<span class="string">&quot;Green&quot;</span>);
                    <span class="keyword">break</span>;
                <span class="keyword">case</span> <span class="number">1</span>:
                    value <span class="operator">=</span> tr(<span class="string">&quot;Red&quot;</span>);
                    <span class="keyword">break</span>;
                <span class="keyword">case</span> <span class="number">2</span>:
                    value <span class="operator">=</span> tr(<span class="string">&quot;Yellow&quot;</span>);
                    <span class="keyword">break</span>;
            }
        }

        <span class="keyword">if</span> (indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">2</span>) { <span class="comment">// 2nd-level item requested</span>
            <span class="keyword">const</span> <span class="type">int</span> header <span class="operator">=</span> indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toInt();
            <span class="keyword">const</span> <span class="type">int</span> childItem <span class="operator">=</span> indexPath<span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">.</span>toInt();

            <span class="keyword">switch</span> (header) {
                <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// &quot;Green&quot;</span>
                    <span class="keyword">switch</span> (childItem) {
                        <span class="keyword">case</span> <span class="number">0</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Cucumber&quot;</span>);
                            <span class="keyword">break</span>;
                        <span class="keyword">case</span> <span class="number">1</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Peas&quot;</span>);
                            <span class="keyword">break</span>;
                        <span class="keyword">case</span> <span class="number">2</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Salad&quot;</span>);
                            <span class="keyword">break</span>;
                    }
                    <span class="keyword">break</span>;
                <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// &quot;Red&quot;</span>
                    <span class="keyword">switch</span> (childItem) {
                        <span class="keyword">case</span> <span class="number">0</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Tomato&quot;</span>);
                            <span class="keyword">break</span>;
                        <span class="keyword">case</span> <span class="number">1</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Red Radish&quot;</span>);
                            <span class="keyword">break</span>;
                        <span class="keyword">case</span> <span class="number">2</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Carrot&quot;</span>);
                            <span class="keyword">break</span>;
                    }
                    <span class="keyword">break</span>;
                <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// &quot;Yellow&quot;</span>
                    <span class="keyword">switch</span> (childItem) {
                        <span class="keyword">case</span> <span class="number">0</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Corn&quot;</span>);
                            <span class="keyword">break</span>;
                        <span class="keyword">case</span> <span class="number">1</span>:
                            value <span class="operator">=</span> tr(<span class="string">&quot;Paprika&quot;</span>);
                            <span class="keyword">break</span>;
                    }
                    <span class="keyword">break</span>;
            }
        }

        <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qDebug">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;Data for &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> indexPath <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot; is &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> value;

        <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span>(value);
    }</pre>
</div>
<!-- @@@vegetablesdatamodel -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
