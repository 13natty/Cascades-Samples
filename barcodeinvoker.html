<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- barcodeinvoker.qdoc -->
  <title>Cascades : Barcode Invoker Example</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
<li><a href="http://qt.nokia.com/doc/4.7/all-examples.html">Examples</a></li>
<li>Barcode Invoker Example</li>
    </ul>
  </div>
</div>
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#the-ui">The UI</a></li>
</ul>
</div>
<h1 class="title">Barcode Invoker Example</h1>
<span class="subtitle"></span>
<!-- $$$barcodeinvoker-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="barcodeinvoker-assets-main-qml.html">barcodeinvoker/assets/main.qml</a></li>
<li><a href="barcodeinvoker-src-barcodeinvoker-cpp.html">barcodeinvoker/src/BarcodeInvoker.cpp</a></li>
<li><a href="barcodeinvoker-src-barcodeinvoker-hpp.html">barcodeinvoker/src/BarcodeInvoker.hpp</a></li>
<li><a href="barcodeinvoker-src-main-cpp.html">barcodeinvoker/src/main.cpp</a></li>
<li><a href="barcodeinvoker-barcodeinvoker-pro.html">barcodeinvoker/barcodeinvoker.pro</a></li>
<li><a href="barcodeinvoker-translations-barcodeinvoker-pro.html">barcodeinvoker/translations/barcodeinvoker.pro</a></li>
</ul>
<a name="description"></a>
<h2>Description</h2>
<p>The Barcode Invoker example allows the user to scan barcodes via a Card through the <tt>InvokeManager</tt> by issuing scan requests.</p>
<p class="centerAlign"><img src="images/barcodeinvoker-example.png" /></p><p class="centerAlign"><img src="images/barcodeinvoker-example1.png" /></p><a name="overview"></a>
<h2>Overview</h2>
<p>In this example we'll learn how to use the <tt>InvokeManager</tt> class to issue barcode scanning requests to the BarcodeScanner Card and retrieve the decoded barcode data from the Card.</p>
<a name="the-ui"></a>
<h2>The UI</h2>
<p>The simplistic UI of this sample application consists of a <tt>Button</tt> to issue requests, and a <tt>Label</tt> to display the request results.</p>
<pre class="qml">    <span class="type">Container</span> {
        <span class="name">layout</span>: <span class="name">DockLayout</span> {
        }

        <span class="name">background</span>: <span class="name">Color</span>.<span class="name">Black</span>

        <span class="type">Container</span> {
            <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
            <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Fill</span>

            <span class="name">bottomPadding</span>: <span class="number">20</span>

            <span class="name">layout</span>: <span class="name">DockLayout</span> {
            }

            <span class="comment">// The background image</span>
            <span class="type">ImageView</span> {
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
                <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Fill</span>
                <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/background.png&quot;</span>
            }
        }

        <span class="type">Container</span> {
            <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
            <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Fill</span>

            <span class="name">topPadding</span>: <span class="number">20</span>
            <span class="name">leftPadding</span>: <span class="number">20</span>
            <span class="name">bottomPadding</span>: <span class="number">20</span>

            <span class="name">layout</span>: <span class="name">DockLayout</span> {
            }

            <span class="comment">//Button to invoke the barcodescanner card - for this to work</span>
            <span class="comment">//you have to have barcodescanner sample on device</span>
            <span class="type">Button</span> {
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Top</span>

                <span class="name">text</span>: <span class="name">qsTr</span>(<span class="string">&quot;Scan Barcode&quot;</span>)
                <span class="name">onClicked</span>: {
                    <span class="name">_barcodeInvoker</span>.<span class="name">onInvokeButtonClicked</span>()
                }
            }
            <span class="comment">//displays barcode data</span>
            <span class="type">Label</span> {
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Left</span>
                <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Bottom</span>

                <span class="name">text</span>: <span class="name">qsTr</span>(<span class="string">&quot;Barcode: %1&quot;</span>).<span class="name">arg</span>(<span class="name">_barcodeInvoker</span>.<span class="name">barcode</span>)
                <span class="name">textStyle</span>.color: <span class="name">Color</span>.<span class="name">White</span>
            }
        }
    }</pre>
<p>When the <tt>Button</tt> is clicked, the request is sent and the barcodescanner card is invoked and transitions over the parent to begin barcode scanning. Once the barcode is read and decoded, the card sends a cardDone() signal to the requesting parent, transitions off screen and is pooled to await subsequent invokation requests. The Label's text property is bound to the BarcodeInvoker barcode property, which gets updated when barcodeChanged() signal is emited.</p>
<pre class="cpp">    BarcodeInvoker<span class="operator">::</span>BarcodeInvoker(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">*</span> parent)
        : <span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span>(parent)
    {
        connect(<span class="keyword">new</span> InvokeManager(<span class="keyword">this</span>)<span class="operator">,</span> SIGNAL(childCardDone(<span class="keyword">const</span> bb<span class="operator">::</span>system<span class="operator">::</span>CardDoneMessage<span class="operator">&amp;</span>))<span class="operator">,</span>
                <span class="keyword">this</span><span class="operator">,</span> SLOT(onChildCardDone(<span class="keyword">const</span> bb<span class="operator">::</span>system<span class="operator">::</span>CardDoneMessage<span class="operator">&amp;</span>)));
    }</pre>
<p>Constructor initializes <tt>InvokeManager</tt> and hooks into the signal/slot mechanism to receive childCardDone() signals from the invoked Card.</p>
<pre class="cpp">    <span class="type">void</span> BarcodeInvoker<span class="operator">::</span>onInvokeButtonClicked() <span class="keyword">const</span>
    {
        InvokeManager<span class="operator">*</span> imanager <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>InvokeManager<span class="operator">*</span><span class="operator">&gt;</span>(sender());

        InvokeRequest invokeRequest;
        invokeRequest<span class="operator">.</span>setTarget(<span class="string">&quot;com.example.BarcodeScanner&quot;</span>);
        invokeRequest<span class="operator">.</span>setAction(<span class="string">&quot;community.action.SCANBARCODE&quot;</span>);

        <span class="keyword">const</span> InvokeTargetReply <span class="operator">*</span>invokeReply <span class="operator">=</span> imanager<span class="operator">-</span><span class="operator">&gt;</span>invoke(invokeRequest);

        <span class="keyword">if</span> (<span class="operator">!</span>invokeReply)
            <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qWarning">qWarning</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;failed to sent invoke request message&quot;</span>;
    }

    <span class="type">void</span> BarcodeInvoker<span class="operator">::</span>onChildCardDone(<span class="keyword">const</span> bb<span class="operator">::</span>system<span class="operator">::</span>CardDoneMessage <span class="operator">&amp;</span>message)
    {
        setBarcode(message<span class="operator">.</span>data());
    }

    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> BarcodeInvoker<span class="operator">::</span>barcode() <span class="keyword">const</span>
    {
        <span class="keyword">return</span> m_barcode;
    }

    <span class="type">void</span> BarcodeInvoker<span class="operator">::</span>setBarcode(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>barcode)
    {
        <span class="keyword">if</span> (m_barcode <span class="operator">=</span><span class="operator">=</span> barcode)
            <span class="keyword">return</span>;

        m_barcode <span class="operator">=</span> barcode;
        Q_EMIT barcodeChanged();
    }</pre>
<p>The onInvokeButtonClicked() method creates <tt>InvokeRequest</tt> and invokes the request via <tt>InvokeManager</tt>. Once the card finishes processing the onChildCardDone() is invoked and sets the barcode textual data from the result, which than emits a barcodeChanged() signal via the setBarcode() method for the QML to update the <tt>Label</tt>'s text property.</p>
</div>
<!-- @@@barcodeinvoker -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
