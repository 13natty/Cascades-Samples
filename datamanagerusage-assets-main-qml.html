<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Cascades : main.qml Example File (datamanagerusage/assets/main.qml)</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
    </ul>
  </div>
</div>
<div class="content mainContent">
<h1 class="title">main.qml Example File</h1>
<span class="small-subtitle">datamanagerusage/assets/main.qml</span>
<!-- $$$datamanagerusage/assets/main.qml-description -->
<div class="descr"> <a name="details"></a>
<pre class="qml">    <span class="comment">/*
     * Copyright (c) 2013 BlackBerry Limited.
     *
     * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */</span>
    import bb.cascades 1.0
    import bb.cascades.datamanager 1.2
    import bb.system 1.0

    <span class="comment">/*
     * This page shows database rows, with menu options to allow switching
     * between various dataModels to demonstrate the performance difference of the cache
     * when using sqlDataQuery with optional properties such as keyColumn or revisionColumn.
     */</span>
    <span class="type">Page</span> {
        <span class="name">id</span>: <span class="name">root</span>
        <span class="comment">// global property to indicate when live revision update is in progress</span>
        <span class="comment">// so that a concurrent selection of live updates terminates the process</span>
        property <span class="type">bool</span> <span class="name">liveUpdate</span>: <span class="number">false</span>;

        <span class="comment">// sql query for updating the revision id in the revision table</span>
        property <span class="type">string</span> <span class="name">updateRevision</span>: <span class="string">&quot;update revision set revision_id = revision_id + 1&quot;</span>
        <span class="comment">// sql query to select revision id from the revision table</span>
        property <span class="type">string</span> <span class="name">selectRevision</span>: <span class="string">&quot;select revision_id from revision&quot;</span>
        <span class="comment">// sql query to insert a new artist row. This query makes use of bound properties and up-to-date revision id through select statement.</span>
        property <span class="type">string</span> <span class="name">insertQuery</span>: <span class="string">&quot;insert into artist(revision_id,name,realname,profile,data_quality,primary_image,is_group,master_count,group_master_count) select revision_id,:name,:realname,:profile,:dataquality,:primaryimage,0,0,0 from revision&quot;</span>
        <span class="comment">// Screen title bar with app name</span>
        <span class="name">titleBar</span>: <span class="name">TitleBar</span> {
            <span class="name">kind</span>: <span class="name">TitleBarKind</span>.<span class="name">FreeForm</span>
            <span class="name">kindProperties</span>: <span class="name">FreeFormTitleBarKindProperties</span> {
                <span class="type">Container</span> {
                    <span class="name">layout</span>: <span class="name">StackLayout</span> {
                        <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
                    }
                    <span class="name">leftPadding</span>: <span class="number">10</span>
                    <span class="name">rightPadding</span>: <span class="number">10</span>

                    <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>

                    <span class="type">Label</span> {
                        <span class="name">text</span>: <span class="string">&quot;Datamanager Usage&quot;</span>

                        <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                            <span class="name">spaceQuota</span>: <span class="number">7</span>
                        }
                        <span class="type">textStyle</span> {
                            <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">TitleText</span>
                            <span class="name">color</span>: <span class="name">Color</span>.<span class="name">White</span>
                        }
                        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>

                    }
                }
            }
        }

        <span class="type">Container</span> {
            <span class="comment">// The ListView that's used to display the artist data</span>
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a></span> {
                <span class="name">id</span>: <span class="name">listView</span>
                <span class="comment">// ListView properties in order to be accessible through ListItemComponents</span>
                property <span class="type">alias</span> <span class="name">deleteq</span>: <span class="name">queryExec</span>
                property <span class="type">string</span> <span class="name">selectRevision</span>: <span class="string">&quot;select revision_id from revision&quot;</span>
                <span class="comment">// sql query to delete artist with specific name</span>
                property <span class="type">string</span> <span class="name">deleteQuery</span>: <span class="string">&quot;delete from artist where name = :name&quot;</span>
                <span class="comment">// this variable holds the current SqlDataQuery that the ListView.dataModel is using</span>
                property <span class="type">variant</span> <span class="name">dq</span>: <span class="name">defaultDataQuery</span>

                <span class="name">layout</span>: <span class="name">StackListLayout</span> {
                    <span class="name">headerMode</span>: <span class="name">ListHeaderMode</span>.<span class="name">Sticky</span>
                }
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">1.0</span>
                }
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
                <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Fill</span>

                <span class="comment">// The current ListView data model being used</span>
                <span class="name">dataModel</span>: <span class="name">defaultModel</span>

                <span class="comment">// Function that returns access path to the data images</span>
                <span class="comment">// _dataDir is a path exposed to the qml context via applicationui.cpp to the apps data folder</span>
                <span class="keyword">function</span> <span class="name">imageurl</span>(<span class="name">image</span>) {
                    <span class="keyword">return</span> <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;images/&quot;</span> <span class="operator">+</span> <span class="name">image</span>;
                }

                <span class="name">listItemComponents</span>: [
                    <span class="comment">// ListComponent to represent default dataModel's</span>
                    <span class="type">ListItemComponent</span> {
                        <span class="comment">// Displays the row data</span>
                        <span class="type">StandardListItem</span> {
                            <span class="name">id</span>: <span class="name">itemRoot</span>
                            <span class="name">title</span>: <span class="name">ListItemData</span>.<span class="name">name</span>
                            <span class="name">imageSource</span>: <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">imageurl</span>(<span class="name">ListItemData</span>.<span class="name">primary_image</span>)
                            <span class="name">description</span>: <span class="name">ListItemData</span>.<span class="name">realname</span>

                            <span class="comment">// function that emits data changed signal with the revision update in order</span>
                            <span class="comment">// to signal for the ListView to refresh; dq holds the dataQuery that the user has selected</span>
                            <span class="keyword">function</span> <span class="name">onDeleteExecuted</span>(<span class="name">resultData</span>) {
                                var <span class="name">revision</span> = <span class="name">resultData</span>[<span class="number">0</span>].<span class="name">revision_id</span>;
                                <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;live delete was performed &quot;</span>);
                                <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">dq</span>.<span class="name">emitDataChanged</span>(<span class="name">revision</span>);
                                <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteq</span>.<span class="name">executed</span>.<span class="name">disconnect</span>(<span class="name">itemRoot</span>.<span class="name">onDeleteExecuted</span>)
                            }

                            <span class="name">gestureHandlers</span>: [
                                <span class="type">LongPressHandler</span> {
                                    <span class="name">onLongPressed</span>: {
                                        <span class="comment">// Set the sql queries to retrieve revision and delete the row with the bound name value</span>
                                        <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteq</span>.<span class="name">queries</span> <span class="operator">=</span> [ <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">selectRevision</span>, <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteQuery</span> ]
                                        <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteq</span>.<span class="name">bindValues</span> <span class="operator">=</span> { &quot;name&quot; : <span class="name">ListItemData</span>.<span class="name">name</span> }
                                        <span class="comment">// Connect to the javascript function, which emits signal to force ListView to refresh after change</span>
                                        <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteq</span>.<span class="name">executed</span>.<span class="name">connect</span>(<span class="name">itemRoot</span>.<span class="name">onDeleteExecuted</span>)
                                        <span class="name">itemRoot</span>.<span class="name">ListItem</span>.<span class="name">view</span>.<span class="name">deleteq</span>.<span class="name">execute</span>()
                                    }
                                }
                            ]
                        }
                    }
                ]
                <span class="name">onDataModelChanged</span>: {
                    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;onDataModelChanged....&quot;</span>)
                }
                <span class="name">onSelectionChanged</span>: {
                    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;onSelectionChanged, selected: &quot;</span> <span class="operator">+</span> <span class="name">selected</span>)
                }
                <span class="name">onActivationChanged</span>: {
                    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;onActivationChanged, active: &quot;</span> <span class="operator">+</span> <span class="name">active</span>)
                }
            }
        }

        <span class="comment">// Load the default model on application startup</span>
        <span class="name">onCreationCompleted</span>: {
            <span class="name">defaultModel</span>.<span class="name">load</span>()
        }

        <span class="name">attachedObjects</span>: [
            <span class="comment">// One of the default provided DataModel's</span>
            <span class="type">AsyncDataModel</span> {
                <span class="name">id</span>: <span class="name">defaultModel</span>
                <span class="comment">// Standard data query that does not make use of any performance improving</span>
                <span class="comment">// properties (i.e. keyColumn, revisionColumn)</span>
                <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                    <span class="name">id</span>: <span class="name">defaultDataQuery</span>
                    <span class="name">source</span>: <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                    <span class="name">query</span>: <span class="string">&quot;select id, name, realname, data_quality, primary_image, is_group, revision_id from artist order by name&quot;</span>
                    <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                    <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                    <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
                }
                <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
            },
            <span class="type">AsyncDataModel</span> {
                <span class="name">id</span>: <span class="name">withKeyModel</span>
                <span class="comment">// Data query that uses one of the performance improving properties - keyColumn</span>
                <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                    <span class="name">id</span>: <span class="name">kdq</span>
                    <span class="name">source</span>: <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                    <span class="name">query</span>: <span class="string">&quot;select id, name, realname, data_quality, primary_image, is_group, revision_id from artist order by name&quot;</span>
                    <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                    <span class="name">keyColumn</span>: <span class="string">&quot;id&quot;</span>
                    <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                    <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
                }
                <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
            },
            <span class="type">AsyncDataModel</span> {
                <span class="name">id</span>: <span class="name">withRevisionModel</span>
                <span class="comment">// Data query that uses one of the performance improving properties - (revisionColumn, revisionQuery)</span>
                <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                    <span class="name">id</span>: <span class="name">rdq</span>
                    <span class="name">source</span>: <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                    <span class="name">query</span>: <span class="string">&quot;select id, name, realname, data_quality, primary_image, is_group, revision_id from artist order by name&quot;</span>
                    <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                    <span class="name">revisionColumn</span>: <span class="string">&quot;revision_id&quot;</span>
                    <span class="name">revisionQuery</span>: <span class="string">&quot;SELECT revision_id FROM revision&quot;</span>
                    <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                    <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
                }
                <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
            },
            <span class="type">AsyncDataModel</span> {
                <span class="name">id</span>: <span class="name">withKeyAndRevisionModel</span>
                <span class="comment">// Data query that uses both performance improving properties - keyColumn, (revisionColumn, revisionQuery)</span>
                <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                    <span class="name">id</span>: <span class="name">krdq</span>
                    <span class="name">source</span>: <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                    <span class="name">query</span>: <span class="string">&quot;select id, name, realname, data_quality, primary_image, is_group, revision_id from artist order by name&quot;</span>
                    <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                    <span class="name">keyColumn</span>: <span class="string">&quot;id&quot;</span>
                    <span class="name">revisionColumn</span>: <span class="string">&quot;revision_id&quot;</span>
                    <span class="name">revisionQuery</span>: <span class="string">&quot;SELECT revision_id FROM revision&quot;</span>
                    <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                    <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
                }
                <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
            },
            <span class="type">QueryExec</span> {
                <span class="comment">// ***************************************************************************</span>
                <span class="comment">// Start it by calling execute(). Can be stopped by calling stop().</span>
                <span class="comment">// Each time it will update x rows (including both overall revision, item revision)</span>
                <span class="comment">// and then notify the data model via its associated query.</span>
                <span class="comment">// Next time (after 1 second delay) it will go down 100 rows and do the same.</span>
                //

                <span class="comment">// Query sequence:</span>
                property <span class="type">string</span> <span class="name">updateContact</span>: <span class="string">&quot;update artist set revision_id = (select revision_id from revision) &quot;</span> <span class="operator">+</span>
                <span class="string">&quot;where rowid &gt;= :startRow and rowid &lt; (:startRow + 5)&quot;</span>
                property <span class="type">int</span> <span class="name">startRow</span>: <span class="number">0</span>
                <span class="name">id</span>:         <span class="name">updateQuery</span>
                <span class="name">times</span>:      <span class="number">10</span> <span class="comment">// execute x times (default is 1)</span>
                <span class="name">interval</span>:   <span class="number">5000</span> <span class="comment">// delay y milliseconds before each execution (default is 1000)</span>
                <span class="name">source</span>:     <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                <span class="name">queries</span>:    [ <span class="name">updateRevision</span>, <span class="name">updateContact</span>, <span class="name">selectRevision</span> ]
                <span class="name">bindValues</span>: { &quot;startRow&quot; : <span class="name">startRow</span> }
                <span class="name">onError</span>:    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;live update error: &quot;</span> <span class="operator">+</span> <span class="name">errorType</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">errorMessage</span>)
                <span class="name">onExecuted</span>: {
                    var <span class="name">revision</span> = <span class="name">data</span>[<span class="number">0</span>].<span class="name">revision_id</span>;
                    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;live query update was performed: startRow=&quot;</span> <span class="operator">+</span> <span class="name">startRow</span> <span class="operator">+</span> <span class="string">&quot;; revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>);
                    <span class="name">listView</span>.<span class="name">dq</span>.<span class="name">emitDataChanged</span>(<span class="name">revision</span>);
                    <span class="name">startRow</span> <span class="operator">=</span> (<span class="name">startRow</span> <span class="operator">+</span> <span class="number">100</span>) <span class="operator">%</span> <span class="number">1000</span>; <span class="comment">// next time start further down, wrapping at the bottom of the 1024 row table</span>
                }
            },
            <span class="comment">// QueryExec instance used for the various SqlDataQuery's</span>
            <span class="type">QueryExec</span> {
                <span class="name">id</span>: <span class="name">queryExec</span>
                <span class="name">source</span>: <span class="name">_dataDir</span> <span class="operator">+</span> <span class="string">&quot;discogs_small.db&quot;</span>
                <span class="name">queries</span>: [ ]
                <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;error: &quot;</span> <span class="operator">+</span> <span class="name">errorType</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">errorMessage</span>)
            },
            <span class="comment">// Toast informing the user on how to delete items in the list</span>
            <span class="type">SystemToast</span> {
                <span class="name">id</span>: <span class="name">deleteToast</span>
                <span class="name">body</span>: <span class="name">qsTr</span>(<span class="string">&quot;Long press an item to remove from list&quot;</span>)
                <span class="name">button</span>.label: <span class="name">qsTr</span>(<span class="string">&quot;Ok&quot;</span>)
                <span class="name">button</span>.enabled: <span class="number">true</span>
            }
        ]

        <span class="name">actions</span>: [
            <span class="comment">// action item to select the key supported sqlDataQuery</span>
            <span class="type">ActionItem</span> {
                <span class="name">title</span>: <span class="string">&quot;sqlDataQuery+key&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/query_with_key.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="name">withKeyModel</span>.<span class="name">load</span>()
                    <span class="name">listView</span>.<span class="name">dq</span> <span class="operator">=</span> <span class="name">kdq</span>
                    <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">withKeyModel</span>
                }
            },
            <span class="comment">// action item to select the revision supported sqlDataQuery</span>
            <span class="type">ActionItem</span> {
                <span class="comment">//ActionBar.placement: ActionBarPlacement.OnBar</span>
                <span class="name">title</span>: <span class="string">&quot;sqlDataQuery+rev&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/query_with_revision.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="name">withRevisionModel</span>.<span class="name">load</span>()
                    <span class="name">listView</span>.<span class="name">dq</span> <span class="operator">=</span> <span class="name">rdq</span>
                    <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">withRevisionModel</span>
                }
            },
            <span class="comment">//action item to select the sqlDataQuery supporting both key and revision</span>
            <span class="type">ActionItem</span> {
                <span class="name">title</span>: <span class="string">&quot;sqlDataQuery+key+rev&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/both.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="name">withKeyAndRevisionModel</span>.<span class="name">load</span>()
                    <span class="name">listView</span>.<span class="name">dq</span> <span class="operator">=</span> <span class="name">krdq</span>
                    <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">withKeyAndRevisionModel</span>
                }
            },
            <span class="comment">// action item to activate live updating of revisions</span>
            <span class="type">ActionItem</span> {
                <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
                <span class="name">title</span>: <span class="string">&quot;LiveUpdate&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/ic_edit.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="keyword">if</span>(!<span class="name">liveUpdate</span>) {
                        <span class="name">updateQuery</span>.<span class="name">execute</span>()
                        <span class="name">liveUpdate</span> <span class="operator">=</span> <span class="number">true</span>
                    } else {
                        <span class="name">updateQuery</span>.<span class="name">stop</span>()
                        <span class="name">liveUpdate</span> <span class="operator">=</span> <span class="number">false</span>
                    }
                }
            },
            <span class="comment">// action item to activate toast describing delete functionality</span>
            <span class="type">ActionItem</span> {
                <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
                <span class="name">title</span>: <span class="string">&quot;delete&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/ic_delete.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="name">deleteToast</span>.<span class="name">exec</span>()
                }
            },
            <span class="comment">// action item to reset back to default model</span>
            <span class="type">ActionItem</span> {
                <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
                <span class="name">title</span>: <span class="string">&quot;Reset&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/list_reset.png&quot;</span>
                <span class="name">onTriggered</span>: {
                    <span class="name">defaultModel</span>.<span class="name">load</span>()
                    <span class="name">listView</span>.<span class="name">dq</span> <span class="operator">=</span> <span class="name">defaultDataQuery</span>
                    <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">defaultModel</span>
                }
            },
            <span class="comment">// action item to add new row item</span>
            <span class="type">ActionItem</span> {
                <span class="name">id</span>: <span class="name">addAction</span>

                <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
                <span class="name">title</span>: <span class="string">&quot;Add&quot;</span>
                <span class="name">imageSource</span>: <span class="string">&quot;images/ic_add.png&quot;</span>

                <span class="comment">// function emits data changed signal with new revision in order</span>
                <span class="comment">// for ListView to refresh so that the addition is visually displayed in the list</span>
                <span class="keyword">function</span> <span class="name">onAddExecuted</span>(<span class="name">resultData</span>) {
                    <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;live record addition &quot;</span>)
                    var <span class="name">revision</span> = <span class="name">resultData</span>[<span class="number">0</span>].<span class="name">revision_id</span>;
                    <span class="name">listView</span>.<span class="name">dq</span>.<span class="name">emitDataChanged</span>(<span class="name">revision</span>);
                    <span class="name">queryExec</span>.<span class="name">executed</span>.<span class="name">disconnect</span>(<span class="name">addAction</span>.<span class="name">onAddExecuted</span>)
                }

                <span class="name">onTriggered</span>: {
                    <span class="comment">// provide query for inserting new row item</span>
                    <span class="name">queryExec</span>.<span class="name">queries</span> <span class="operator">=</span> [ <span class="name">updateRevision</span>, <span class="name">selectRevision</span>, <span class="name">insertQuery</span>]
                    <span class="comment">// query bound values containing the new row artist values</span>
                    <span class="name">queryExec</span>.<span class="name">bindValues</span> <span class="operator">=</span> { &quot;name&quot; : <span class="string">&quot;Homer&quot;</span> <span class="operator">+</span> <span class="name">Math</span>.<span class="name">random</span>().<span class="name">toString</span>(<span class="number">36</span>).<span class="name">substring</span>(<span class="number">2</span>, <span class="number">8</span>),
                                             &quot;realname&quot; : &quot;Baercis&quot;,
                                             &quot;profile&quot; : &quot;Sr.Attorney at large&quot;,
                                             &quot;dataquality&quot; : &quot;Correct&quot;,
                                             &quot;primaryimage&quot; : &quot;blah.jpg&quot;}
                    <span class="comment">// connects to the javascript function which emits signal to force ListView to refresh</span>
                    <span class="name">queryExec</span>.<span class="name">executed</span>.<span class="name">connect</span>(<span class="name">addAction</span>.<span class="name">onAddExecuted</span>)
                    <span class="name">queryExec</span>.<span class="name">execute</span>()
                }
            }
        ]
    }</pre>
</div>
<!-- @@@datamanagerusage/assets/main.qml -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
