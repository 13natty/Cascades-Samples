<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- listdecorators.qdoc -->
  <title>Cascades : List Decorators Example</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
<li><a href="http://qt.nokia.com/doc/4.7/all-examples.html">Examples</a></li>
<li>List Decorators Example</li>
    </ul>
  </div>
</div>
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#the-ui">The UI</a></li>
<li class="level1"><a href="#the-applicatoinui-class">The ApplicatoinUI class</a></li>
<li class="level1"><a href="#the-datamodelloggerdecorator-class">The DataModelLoggerDecorator class</a></li>
<li class="level1"><a href="#the-dataqualitydataquerydecorator-class">The DataQualityDataQueryDecorator class</a></li>
<li class="level1"><a href="#the-dataqualitymodeldecorator-class">The DataQualityModelDecorator class</a></li>
<li class="level1"><a href="#the-expandabledatamodeldecorator-class">The ExpandableDataModelDecorator class</a></li>
<li class="level1"><a href="#the-groupartistdatamodeldecorator-class">The GroupArtistDataModelDecorator class</a></li>
<li class="level1"><a href="#the-groupstyledataquerydecorator-class">The GroupStyleDataQueryDecorator class</a></li>
<li class="level1"><a href="#the-selectiondatamodeldecorator-class">The SelectionDataModelDecorator class</a></li>
</ul>
</div>
<h1 class="title">List Decorators Example</h1>
<span class="subtitle"></span>
<!-- $$$listdecorators-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="listdecorators-precompiled-h.html">listdecorators/precompiled.h</a></li>
<li><a href="listdecorators-assets-coverart-qml.html">listdecorators/assets/CoverArt.qml</a></li>
<li><a href="listdecorators-assets-dataloggerdecorator-qml.html">listdecorators/assets/DataLoggerDecorator.qml</a></li>
<li><a href="listdecorators-assets-dataqualitydecorator-qml.html">listdecorators/assets/DataQualityDecorator.qml</a></li>
<li><a href="listdecorators-assets-dataqualitylistcomponent-qml.html">listdecorators/assets/DataQualityListComponent.qml</a></li>
<li><a href="listdecorators-assets-expandabledecorator-qml.html">listdecorators/assets/ExpandableDecorator.qml</a></li>
<li><a href="listdecorators-assets-groupartistdecorator-qml.html">listdecorators/assets/GroupArtistDecorator.qml</a></li>
<li><a href="listdecorators-assets-groupartistlistcomponent-qml.html">listdecorators/assets/GroupArtistListComponent.qml</a></li>
<li><a href="listdecorators-assets-groupstyledecorator-qml.html">listdecorators/assets/GroupStyleDecorator.qml</a></li>
<li><a href="listdecorators-assets-selectabledecorator-qml.html">listdecorators/assets/SelectableDecorator.qml</a></li>
<li><a href="listdecorators-assets-selectablelistcomponent-qml.html">listdecorators/assets/SelectableListComponent.qml</a></li>
<li><a href="listdecorators-assets-main-qml.html">listdecorators/assets/main.qml</a></li>
<li><a href="listdecorators-src-datamodelloggerdecorator-cpp.html">listdecorators/src/DataModelLoggerDecorator.cpp</a></li>
<li><a href="listdecorators-src-datamodelloggerdecorator-hpp.html">listdecorators/src/DataModelLoggerDecorator.hpp</a></li>
<li><a href="listdecorators-src-dataqualitydataquerydecorator-cpp.html">listdecorators/src/DataQualityDataQueryDecorator.cpp</a></li>
<li><a href="listdecorators-src-dataqualitydataquerydecorator-hpp.html">listdecorators/src/DataQualityDataQueryDecorator.hpp</a></li>
<li><a href="listdecorators-src-dataqualitymodeldecorator-cpp.html">listdecorators/src/DataQualityModelDecorator.cpp</a></li>
<li><a href="listdecorators-src-dataqualitymodeldecorator-hpp.html">listdecorators/src/DataQualityModelDecorator.hpp</a></li>
<li><a href="listdecorators-src-expandabledatamodeldecorator-cpp.html">listdecorators/src/ExpandableDataModelDecorator.cpp</a></li>
<li><a href="listdecorators-src-expandabledatamodeldecorator-hpp.html">listdecorators/src/ExpandableDataModelDecorator.hpp</a></li>
<li><a href="listdecorators-src-groupartistdatamodeldecorator-cpp.html">listdecorators/src/GroupArtistDataModelDecorator.cpp</a></li>
<li><a href="listdecorators-src-groupartistdatamodeldecorator-hpp.html">listdecorators/src/GroupArtistDataModelDecorator.hpp</a></li>
<li><a href="listdecorators-src-groupstyledataquerydecorator-cpp.html">listdecorators/src/GroupStyleDataQueryDecorator.cpp</a></li>
<li><a href="listdecorators-src-groupstyledataquerydecorator-hpp.html">listdecorators/src/GroupStyleDataQueryDecorator.hpp</a></li>
<li><a href="listdecorators-src-selectiondatamodeldecorator-cpp.html">listdecorators/src/SelectionDataModelDecorator.cpp</a></li>
<li><a href="listdecorators-src-selectiondatamodeldecorator-hpp.html">listdecorators/src/SelectionDataModelDecorator.hpp</a></li>
<li><a href="listdecorators-src-applicationui-cpp.html">listdecorators/src/applicationui.cpp</a></li>
<li><a href="listdecorators-src-applicationui-hpp.html">listdecorators/src/applicationui.hpp</a></li>
<li><a href="listdecorators-src-main-cpp.html">listdecorators/src/main.cpp</a></li>
<li><a href="listdecorators-listdecorators-pro.html">listdecorators/listdecorators.pro</a></li>
<li><a href="listdecorators-translations-listdecorators-pro.html">listdecorators/translations/listdecorators.pro</a></li>
</ul>
<a name="description"></a>
<h2>Description</h2>
<p>The List Decorators example shows how the user can extend the behaviour and enhance the appearance of <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> by extending and implementing additional functionality in the DataModel/DataQuery decorators.</p>
<p class="centerAlign"><img src="images/listdecorators-example.png" /></p><p class="centerAlign"><img src="images/listdecorators-example1.png" /></p><p class="centerAlign"><img src="images/listdecorators-example2.png" /></p><a name="overview"></a>
<h2>Overview</h2>
<p>In this example we'll learn how to extend the DataModelDecorator or the DataQueryDecorator. By extending these decorators it allows as to insert new data or to modify existing data to enrich the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> appearance. This can also be useful when we want to reinterpret the data before it is used by <tt>ListView</tt>.</p>
<a name="the-ui"></a>
<h2>The UI</h2>
<p>The UI of this sample application consists of a <tt>ListView</tt> that simply shows the content based on the selected custom decorator.</p>
<p>We create custom decorators in C++, register their types with qml and define them as attached objects.</p>
<pre class="qml">    <span class="comment">// Each action item loads the appropriate data model and assigns it to the ListView</span>
    <span class="name">actions</span>: [
        <span class="comment">// GroupArtistDecorator menu ActionItem with attached object model</span>
        <span class="type">GroupArtistDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;GroupArtistModelDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_group.png&quot;</span>
        },
        <span class="comment">// GroupStyleDecorator menu ActionItem with attached object model</span>
        <span class="type">GroupStyleDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;GroupStyleDataQueryDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_group.png&quot;</span>
        },
        <span class="comment">// DataQualityDecorator menu ActionItem with attached object model</span>
        <span class="type">DataQualityDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;DataQualityDataQueryDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_quality.png&quot;</span>
        },
        <span class="comment">// ExpandableDecorator menu ActionItem with attached object model</span>
        <span class="type">ExpandableDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;ExpandableDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_expandable.png&quot;</span>
        },
        <span class="comment">// SelectableDecorator menu ActionItem with attached object model</span>
        <span class="type">SelectableDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;SelectableDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_selection.png&quot;</span>
        },
        <span class="comment">// DataLoggerDecorator menu ActionItem with attached object model</span>
        <span class="type">DataLoggerDecorator</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;DataLoggerDecorator&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/logging.png&quot;</span>
        },
        <span class="comment">// Default menu ActionItem using the default attached asyncDataModel</span>
        <span class="type">ActionItem</span> {
            <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Reset&quot;</span>)
            <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/list_reset.png&quot;</span>
            <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">InOverflow</span>
            <span class="name">onTriggered</span>: {
                <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">defaultModel</span>
            }
        }
    ]</pre>
<p>The ActionItem definitions for each decorator. Each ActionItem loads the appropriate data model and assigns the decorator model to the <tt>ListView</tt> when triggered. These definitions instantiate the decorators that will be used by this action item as attached objects.</p>
<pre class="qml">    <span class="comment">// The ListView that's used to display the data using various decorators.</span>
    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a></span> {
        <span class="name">id</span>: <span class="name">listView</span>

        <span class="name">layout</span>: <span class="name">StackListLayout</span> {
            <span class="name">headerMode</span>: <span class="name">ListHeaderMode</span>.<span class="name">Sticky</span>
        }
        <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
            <span class="name">spaceQuota</span>: <span class="number">1.0</span>
        }
        <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Fill</span>

        <span class="name">dataModel</span>: <span class="name">defaultModel</span>

        <span class="comment">// This function deals with providing a default image</span>
        <span class="comment">// when none is provided.</span>
        <span class="keyword">function</span> <span class="name">imageurl</span>(<span class="name">image</span>) {
            <span class="keyword">if</span> (<span class="string">&quot;&quot;</span> <span class="operator">==</span> <span class="name">image</span> <span class="operator">||</span> !<span class="name">_app</span>.<span class="name">fileExists</span>(<span class="name">image</span>)) {
                <span class="keyword">return</span> <span class="name">_sqlImagesDir</span> <span class="operator">+</span> <span class="string">&quot;../../../native/assets/images/no_image.png&quot;</span>

            }
            <span class="keyword">return</span> <span class="name">_sqlImagesDir</span> <span class="operator">+</span> <span class="name">image</span>;
        }

        <span class="name">onTriggered</span>: {
            <span class="name">clearSelection</span>()
            <span class="name">select</span>(<span class="name">indexPath</span>)
        }

        <span class="name">listItemComponents</span>: [
            <span class="comment">// ListComponent's (header and &quot;&quot;) to represent default dataModel's</span>
            <span class="type">ListItemComponent</span> {
                <span class="name">type</span>: <span class="string">&quot;header&quot;</span>
                <span class="type">Container</span> {
                    <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>
                    <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                    <span class="name">background</span>: <span class="name">Color</span>.<span class="name">create</span>(<span class="string">&quot;#0098F0&quot;</span>)

                    <span class="type">Label</span> {
                        <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                        <span class="name">preferredHeight</span>: <span class="number">200</span>
                        <span class="name">text</span>: <span class="name">ListItemData</span>.<span class="name">header</span>
                    }
                    <span class="type">Container</span> {
                        <span class="name">background</span>: <span class="name">Color</span>.<span class="name">White</span>
                        <span class="type">Divider</span> {
                        }
                    }
                }
            },
            <span class="type">ListItemComponent</span> {
                <span class="name">type</span>: <span class="string">&quot;&quot;</span>
                <span class="type">Container</span> {
                    <span class="name">id</span>: <span class="name">item</span>
                    <span class="name">layout</span>: <span class="name">StackLayout</span> {
                        <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
                    }
                    <span class="type">CoverArt</span> {
                    }
                    <span class="type">Label</span> {
                        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                        <span class="name">text</span>: <span class="name">ListItemData</span>.<span class="name">name</span>
                        <span class="type">textStyle</span> {
                            <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">PrimaryText</span>
                        }
                    }
                }
            },
            <span class="comment">// ListComponent definitions to support the associated</span>
            <span class="comment">// data that they wish to display.</span>
            <span class="type">GroupArtistListComponent</span> {
            },
            <span class="type">DataQualityListComponent</span> {
            },
            <span class="type">SelectableListComponent</span> {
            }
        ]
        <span class="name">onSelectionChanged</span>: {
            <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;onSelectionChanged, selected: &quot;</span> <span class="operator">+</span> <span class="name">selected</span>)
        }
        <span class="name">onActivationChanged</span>: {
            <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;onActivationChanged, active: &quot;</span> <span class="operator">+</span> <span class="name">active</span>)
        }
    }</pre>
<p>The <tt>ListView</tt> uses the defined data decorators as its data model based on which one is selected. This data model loading and changing is accomplished through the ActionItem's that were previously defined for each decorator. It also defines the custom ListItemComponent's to deal with the various decorator item types.</p>
<pre class="qml">    <span class="name">attachedObjects</span>: [
        <span class="comment">// One of the default provided DataModel's</span>
        <span class="type">AsyncDataModel</span> {
            <span class="name">id</span>: <span class="name">defaultModel</span>
            <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                <span class="name">source</span>: <span class="name">_sqlImagesDir</span> <span class="operator">+</span> <span class="string">&quot;/../discogs_small.db&quot;</span>
                <span class="name">query</span>: <span class="string">&quot;select name, primary_image, is_group from artist order by name&quot;</span>
                <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
            }
            <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
        }
    ]</pre>
<p>Instantiates one of the default provided data model extensions as the default model for the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> upon sample startup, the list view data model is always reverted to this model when user selects the &quot;Reset&quot; menu item.</p>
<pre class="qml">    <span class="comment">// ActionItem dealing with the logging decorator</span>
    <span class="comment">// which illustrates how to provide logging for</span>
    <span class="comment">// debugging purposes.</span>
    <span class="type">ActionItem</span> {
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">InOverflow</span>
        <span class="name">onTriggered</span>: {
            <span class="name">dataLoggerDecorator</span>.<span class="name">load</span>()
            <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">dataLoggerDecorator</span>
        }

        <span class="name">attachedObjects</span>: [
            <span class="comment">// Logger Decorator instantiation</span>
            <span class="type">DataModelLoggerDecorator</span> {
                <span class="name">id</span>: <span class="name">dataLoggerDecorator</span>
                <span class="name">model</span>: <span class="name">defaultModel</span>
            }
        ]
    }</pre>
<p>This custom component declares a DataLoggerDecorator <tt>ActionItem</tt>, which loads the Decorator DataModel and assigns it to the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> when triggered. This DataModel decorator is defined as an attached object. The amount of logging is increased upon triggering this item.</p>
<pre class="qml">    <span class="comment">// ActionItem that deals with the Data Quality decorator,</span>
    <span class="comment">// which decorates the list data with quality icons based</span>
    <span class="comment">// on the quality field value.</span>
    <span class="type">ActionItem</span> {
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">InOverflow</span>
        <span class="name">onTriggered</span>: {
            <span class="name">dataQualityModel</span>.<span class="name">load</span>()
            <span class="name">listView</span>.<span class="name">dataModel</span> <span class="operator">=</span> <span class="name">dataQualityDecorator</span>
        }

        <span class="name">attachedObjects</span>: [
            <span class="comment">// DataQualityModelDecorator changes dataType in order to</span>
            <span class="comment">// use the custom ListItemComponent to display this data.</span>
            <span class="type">DataQualityModelDecorator</span> {
                <span class="name">id</span>: <span class="name">dataQualityDecorator</span>
                <span class="name">model</span>:
                <span class="name">AsyncDataModel</span> {
                    <span class="name">id</span>: <span class="name">dataQualityModel</span>
                    <span class="name">query</span>: <span class="name">DataQualityDataQueryDecorator</span> {
                        <span class="name">query</span>: <span class="name">SqlDataQuery</span> {
                            <span class="name">source</span>: <span class="name">_sqlImagesDir</span> <span class="operator">+</span> <span class="string">&quot;/../discogs_small.db&quot;</span>
                            <span class="name">query</span>: <span class="string">&quot;select name, data_quality,primary_image from artist&quot;</span>
                            <span class="name">countQuery</span>: <span class="string">&quot;select count(*) from artist&quot;</span>
                            <span class="name">onDataChanged</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;data changed: revision=&quot;</span> <span class="operator">+</span> <span class="name">revision</span>)
                            <span class="name">onError</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;SQL query error: &quot;</span> <span class="operator">+</span> <span class="name">code</span> <span class="operator">+</span> <span class="string">&quot;, &quot;</span> <span class="operator">+</span> <span class="name">message</span>)
                        }
                    }
                    <span class="name">onLoaded</span>: <span class="name">console</span>.<span class="name">log</span>(<span class="string">&quot;initial model data is loaded&quot;</span>)
                }
            }
        ]
    }</pre>
<p>This custom component is a good example of how to chain the various decorator classes together with the default library convenience classes that are included with the library. With this component we provide an action item that triggers the loading of custom decorator classes that are designed to decorate the list items with icons based on their &quot;data_quality&quot; field data content.</p>
<p>The rest of the defined Decorator qml components follow the same above pattern, each defining the ActionItem representing the decorator, and the decorator as an attached object, which is loaded and assigned to the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> upon it's triggering.</p>
<pre class="qml">    <span class="comment">// Custom ListItemComponent that provides a different visual</span>
    <span class="comment">// display for group data items which have been identified in</span>
    <span class="comment">// conjunction with the GroupArtistDecorator.</span>
    <span class="type">ListItemComponent</span> {
        <span class="name">type</span>: <span class="string">&quot;group&quot;</span>
        <span class="type">Container</span> {
            <span class="name">id</span>: <span class="name">item</span>
            <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>

            <span class="name">layout</span>: <span class="name">StackLayout</span> {
                <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
            }

            <span class="type">Container</span> {
                <span class="name">layout</span>: <span class="name">StackLayout</span> {
                    <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
                }
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">1</span>
                }

                <span class="name">background</span>: <span class="name">Color</span>.<span class="name">Black</span>

                <span class="type">CoverArt</span> {
                }
                <span class="type">Container</span> {
                    <span class="name">layout</span>: <span class="name">DockLayout</span> {
                    }
                    <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                        <span class="name">spaceQuota</span>: <span class="number">1</span>
                    }

                    <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                    <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Fill</span>

                    <span class="type">ImageView</span> {
                        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/grouptag.png&quot;</span>
                        <span class="name">opacity</span>: <span class="number">0.7</span>
                    }
                    <span class="type">Container</span> {
                        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                        <span class="name">leftPadding</span>: <span class="number">85</span>

                        <span class="type">Label</span> {
                            <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Left</span>
                            <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Center</span>
                            <span class="name">text</span>: <span class="name">ListItemData</span>.<span class="name">name</span>
                            <span class="type">textStyle</span> {
                                <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">PrimaryText</span>
                            }
                        }
                    }
                }
            }
        }
    }</pre>
<p>These types of components define the custom ListItemComponent's that are used by the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> to represent data from the model for items that are of a particular type (i.e&#x2e; group). It contains whatever visual controls that you wish to use in order to represent the data in your list item.</p>
<a name="the-applicatoinui-class"></a>
<h2>The ApplicatoinUI class</h2>
<p><tt>ApplicatoinUI</tt> is the central class of the application that creates the UI and registers the various decorator classes.</p>
<pre class="cpp">    ApplicationUI<span class="operator">::</span>ApplicationUI(bb<span class="operator">::</span>cascades<span class="operator">::</span>Application <span class="operator">*</span>app)
        : <span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span>(app)
    {
        qmlRegisterType<span class="operator">&lt;</span>GroupArtistDataModelDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span>
                <span class="number">2</span><span class="operator">,</span> <span class="string">&quot;GroupArtistDataModelDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>GroupStyleDataQueryDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span>
                <span class="number">2</span><span class="operator">,</span> <span class="string">&quot;GroupStyleDataQueryDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>DataQualityDataQueryDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span>
                <span class="number">2</span><span class="operator">,</span> <span class="string">&quot;DataQualityDataQueryDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>DataQualityModelDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span>
                <span class="string">&quot;DataQualityModelDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>ExpandableDataModelDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span>
                <span class="number">2</span><span class="operator">,</span> <span class="string">&quot;ExpandableDataModelDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>SelectionDataModelDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span>
                <span class="string">&quot;SelectionDataModelDecorator&quot;</span>);
        qmlRegisterType<span class="operator">&lt;</span>DataModelLoggerDecorator<span class="operator">&gt;</span>(<span class="string">&quot;bb.cascades.decorators&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="number">2</span><span class="operator">,</span>
                <span class="string">&quot;DataModelLoggerDecorator&quot;</span>);

        <span class="comment">// create scene document from main.qml asset</span>
        <span class="comment">// set parent to created document to ensure it exists for the whole application lifetime</span>
        QmlDocument <span class="operator">*</span>qml <span class="operator">=</span> QmlDocument<span class="operator">::</span>create(<span class="string">&quot;asset:///main.qml&quot;</span>)<span class="operator">.</span>parent(<span class="keyword">this</span>);

        <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> workingDir <span class="operator">=</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qdir.html">QDir</a></span><span class="operator">::</span>currentPath();
        <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> dirPaths <span class="operator">=</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span><span class="operator">::</span>fromLatin1(
                <span class="string">&quot;file://%1/app/public/data/images/&quot;</span>)<span class="operator">.</span>arg(workingDir);
        m_sqlImages <span class="operator">=</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qdir.html">QDir</a></span>(workingDir <span class="operator">+</span> <span class="string">&quot;/app/public/data/images&quot;</span>);

        qml<span class="operator">-</span><span class="operator">&gt;</span>documentContext()<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(<span class="string">&quot;_sqlImagesDir&quot;</span><span class="operator">,</span> dirPaths);
        qml<span class="operator">-</span><span class="operator">&gt;</span>documentContext()<span class="operator">-</span><span class="operator">&gt;</span>setContextProperty(<span class="string">&quot;_app&quot;</span><span class="operator">,</span> <span class="keyword">this</span>);

        <span class="comment">// create root object for the UI</span>
        AbstractPane <span class="operator">*</span>root <span class="operator">=</span> qml<span class="operator">-</span><span class="operator">&gt;</span>createRootObject<span class="operator">&lt;</span>AbstractPane<span class="operator">&gt;</span>();
        <span class="comment">// set created root object as a scene</span>
        app<span class="operator">-</span><span class="operator">&gt;</span>setScene(root);
    }</pre>
<p>Inside the constructor of <tt>ApplicatoinUI</tt> we register the decorators with the QML type system to enable the classes to be used as a data type within the QML code.</p>
<p>Afterwards we load the UI from the main.qml file and export the data images path <a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a> object under the name '_sqlImagesDir' to QML context.</p>
<a name="the-datamodelloggerdecorator-class"></a>
<h2>The DataModelLoggerDecorator class</h2>
<p>Like any other data model decorators in Cascades, the <tt>DataModelLoggerDecorator</tt> also must inherit from the base class <tt>bb::cascades::datamanager::DataModelDecorator</tt>.</p>
<pre class="cpp">    <span class="keyword">class</span> DataModelLoggerDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator {
        Q_OBJECT

        <span class="comment">// Property for toggling data logging.</span>
        Q_PROPERTY(<span class="type">bool</span> dataDetails READ logData WRITE setLogData)

        <span class="comment">// Property for toggling the start of each function logging.</span>
        Q_PROPERTY(<span class="type">bool</span> funcBegin READ logBegin WRITE setLogBegin)

        <span class="comment">// Property for toggling itemsChanged callback events logging.</span>
        Q_PROPERTY(<span class="type">bool</span> allCallbacks READ logAllCallbacks WRITE setLogAllCallbacks)

    <span class="keyword">public</span>:
        <span class="keyword">explicit</span> DataModelLoggerDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>DataModelLoggerDecorator();

        <span class="comment">/**
         * Call the method childCount of the DataModel it wraps
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type">int</span> childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">/*
         * Call the method hasChildren of the DataModel it wraps
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type">bool</span> hasChildren(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">/**
         * Call the method itemType of the DataModel it wraps
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">/*
         * Call the method data of the DataModel it wraps
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">/**
         * Tell the DataModel to load if it has an invokable load() function.
         */</span>
        Q_INVOKABLE <span class="type">void</span> load();

        <span class="comment">/**
         * Whether to log the details of each data item that is returned.
         * return If true, log all details.
         */</span>
        <span class="type">bool</span> logData();

        <span class="comment">/**
         * Setter for the logData variable.
         */</span>
        <span class="type">void</span> setLogData(<span class="type">bool</span> enable);

        <span class="comment">/**
         * Whether to log the start of each instrumented function.
         * return If true, log the start of functions.
         */</span>
        <span class="type">bool</span> logBegin();

        <span class="comment">/**
         * Setter for the logBegin variable.
         */</span>
        <span class="type">void</span> setLogBegin(<span class="type">bool</span> enable);

        <span class="comment">/**
         * Whether to log all itemsChanged callback events, or just the interesting ones,
         * e.g. add/remove.
         * return If true, log all itemsChanged callback events.
         */</span>
        <span class="type">bool</span> logAllCallbacks();

        <span class="comment">/**
         * Setter for the logAllCallbacks variable.
         */</span>
        <span class="type">void</span> setLogAllCallbacks(<span class="type">bool</span> enable);

    <span class="keyword">public</span> Q_SLOTS:
        <span class="comment">// This method emits the onItemAdded signal with the added index path.</span>
        <span class="keyword">virtual</span> <span class="type">void</span> onItemAdded(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> indexPath);

        <span class="comment">// This method emits the onItemUpdated signal with the updated index path.</span>
        <span class="keyword">virtual</span> <span class="type">void</span> onItemUpdated(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> indexPath);

        <span class="comment">// This method emits the onItemRemoved signal with the removed index path.</span>
        <span class="keyword">virtual</span> <span class="type">void</span> onItemRemoved(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> indexPath);

        <span class="comment">// This method emits the onItemsChanged signal with the type of change and IndexMapper to map currently cached items.</span>
        <span class="keyword">virtual</span> <span class="type">void</span> onItemsChanged(
                bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModelChangeType<span class="operator">::</span>Type eChangeType <span class="operator">=</span>
                        bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModelChangeType<span class="operator">::</span>Init<span class="operator">,</span>
                <span class="type"><a href="http://qt.nokia.com/doc/4.7/qsharedpointer.html">QSharedPointer</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper<span class="operator">&gt;</span> indexMapper <span class="operator">=</span>
                        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qsharedpointer.html">QSharedPointer</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper<span class="operator">&gt;</span>(<span class="number">0</span>));

    Q_SIGNALS:
        <span class="comment">// This signal is emited when model is loaded.</span>
        <span class="type">void</span> loaded();

    <span class="keyword">private</span>:
        <span class="comment">// Timer used for logging execution time.</span>
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qelapsedtimer.html">QElapsedTimer</a></span> m_timer;

        <span class="type">bool</span> m_logBegin;
        <span class="type">bool</span> m_logData;
        <span class="type">bool</span> m_logAllCallbacks;

        <span class="comment">// This method pretty prints the start of method with given list argument and starts the execution timer.</span>
        <span class="type">void</span> logStart(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>method<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>list);

        <span class="comment">// This method pretty prints the end of the started method with the methods result and elapsed execution time.</span>
        <span class="type">void</span> logEnd(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>method<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>list<span class="operator">,</span>
                <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>result);Q_DISABLE_COPY(DataModelLoggerDecorator)
        ;
    };</pre>
<p>The intended purpose of this class is to enable highly-verbose logging for debugging only.</p>
<p>It reimplements all the virtual methods and additionally provides methods to enable the logging details of the item's various stages. It contains three member variables, each one representing a different logging granularity that can be enabled.</p>
<pre class="cpp">    <span class="comment">// Custom IndexMapper class for logging purposes.</span>
    <span class="keyword">class</span> IndexMapperLogger: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper {

    <span class="keyword">public</span>:
        <span class="keyword">explicit</span> IndexMapperLogger(
                <span class="type"><a href="http://qt.nokia.com/doc/4.7/qsharedpointer.html">QSharedPointer</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper<span class="operator">&gt;</span> indexMapper<span class="operator">,</span>
                DataModelLoggerDecorator <span class="operator">*</span>model);
        <span class="keyword">virtual</span> <span class="operator">~</span>IndexMapperLogger();

        <span class="keyword">virtual</span> <span class="type">bool</span> newIndexPath(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">*</span>pOutIndexPath<span class="operator">,</span>
                <span class="type">int</span> <span class="operator">*</span>pOutReplacementIndex<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>oldIndexPath) <span class="keyword">const</span>;

    <span class="keyword">private</span>:
        bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel <span class="operator">*</span>model() <span class="keyword">const</span>;

        <span class="comment">// Holds the original IndexMapper class.</span>
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qsharedpointer.html">QSharedPointer</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper<span class="operator">&gt;</span> m_indexMapper;
        DataModelLoggerDecorator <span class="operator">*</span>m_model;
    };</pre>
<p>A custom <tt>IndexMapper</tt> class is declared for logging purposes.</p>
<pre class="cpp">    IndexMapperLogger<span class="operator">::</span>IndexMapperLogger(
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qsharedpointer.html">QSharedPointer</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel<span class="operator">::</span>IndexMapper<span class="operator">&gt;</span> indexMapper<span class="operator">,</span>
            DataModelLoggerDecorator <span class="operator">*</span>model)
        : m_indexMapper(indexMapper)
        <span class="operator">,</span> m_model(model)
    {
    }

    IndexMapperLogger<span class="operator">::</span><span class="operator">~</span>IndexMapperLogger() {
    }

    bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModel <span class="operator">*</span>IndexMapperLogger<span class="operator">::</span>model() <span class="keyword">const</span> {
        <span class="keyword">return</span> m_model<span class="operator">-</span><span class="operator">&gt;</span>model();
    }

    <span class="type">bool</span> IndexMapperLogger<span class="operator">::</span>newIndexPath(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">*</span>pOutIndexPath<span class="operator">,</span>
            <span class="type">int</span> <span class="operator">*</span>pOutReplacementIndex<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>oldIndexPath) <span class="keyword">const</span> {
        <span class="comment">// Store result from original IndexMapper. Log output based on result and return the original</span>
        <span class="comment">// value.</span>
        <span class="type">bool</span> result <span class="operator">=</span> m_indexMapper<span class="operator">-</span><span class="operator">&gt;</span>newIndexPath(pOutIndexPath<span class="operator">,</span>
                pOutReplacementIndex<span class="operator">,</span> oldIndexPath);

        <span class="keyword">if</span> (<span class="operator">!</span>result) {
            <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qDebug">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;DEL: &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> oldIndexPath;
        } <span class="keyword">else</span> <span class="keyword">if</span> (oldIndexPath <span class="operator">!</span><span class="operator">=</span> <span class="operator">*</span>pOutIndexPath) {
            <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qDebug">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;MOV: &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> oldIndexPath <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot; -&gt; &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="operator">*</span>pOutIndexPath;
        } <span class="keyword">else</span> <span class="keyword">if</span> (m_model<span class="operator">-</span><span class="operator">&gt;</span>logAllCallbacks()) {
            <a href="http://qt.nokia.com/doc/4.7/qtglobal.html#qDebug">qDebug</a>() <span class="operator">&lt;</span><span class="operator">&lt;</span> <span class="string">&quot;NOP: &quot;</span> <span class="operator">&lt;</span><span class="operator">&lt;</span> oldIndexPath;
        }

        <span class="keyword">return</span> result;
    }</pre>
<p>The constructor takes and holds the original <tt>IndexMapper</tt> class and the DataModelLoggerDecorator instance. The IndexMapper virtual methods are re-implemented to provide additional logging on top of invoking the original method implementations.</p>
<pre class="cpp">    DataModelLoggerDecorator<span class="operator">::</span>DataModelLoggerDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent)
        : bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator(parent)
        <span class="operator">,</span> m_logBegin(<span class="keyword">true</span>)
        <span class="operator">,</span> m_logData(<span class="keyword">true</span>)
        <span class="operator">,</span> m_logAllCallbacks(<span class="keyword">true</span>)
    {
    }</pre>
<p>Inside the constructor the member variables are initialized.</p>
<pre class="cpp">    <span class="comment">// Introduce log messages, invoke parent method and return it's value.</span>
    <span class="type">int</span> DataModelLoggerDecorator<span class="operator">::</span>childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath) {
        logStart(<span class="string">&quot;childCount()&quot;</span><span class="operator">,</span> indexPath);
        <span class="type">int</span> result <span class="operator">=</span> DataModelDecorator<span class="operator">::</span>childCount(indexPath);
        logEnd(<span class="string">&quot;childCount()&quot;</span><span class="operator">,</span> indexPath<span class="operator">,</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span><span class="operator">::</span>number(result));
        <span class="keyword">return</span> result;
    }</pre>
<p>Each of the re-implemented methods surround the base class invocation with internal methods that enable more logging details.</p>
<a name="the-dataqualitydataquerydecorator-class"></a>
<h2>The DataQualityDataQueryDecorator class</h2>
<p>Like any other data query decorators in Cascades, the <tt>DataQualityDataQueryDecorator</tt> also must inherit from the base class <tt>bb::cascades::datamanager::DataQueryDecorator</tt>.</p>
<pre class="cpp">    <span class="keyword">class</span> DataQualityDataQueryDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataQueryDecorator {
        Q_OBJECT

    <span class="keyword">public</span>:
        DataQualityDataQueryDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">*</span> parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>DataQualityDataQueryDecorator();

        <span class="comment">/**
         * This method injects the proper image path, into the data, based
         * on the data quality field value.
         * Overwritten function to perform special processing on the results.
         *
         * @see DataQueryDecorator
         */</span>
        <span class="type">void</span> processResults(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataItem<span class="operator">&gt;</span><span class="operator">*</span> results);
    };</pre>
<p>The intent of this class is to inject image file names into the data set based on the original data quality field value.</p>
<pre class="cpp">    <span class="type">void</span> DataQualityDataQueryDecorator<span class="operator">::</span>processResults(
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataItem<span class="operator">&gt;</span><span class="operator">*</span> results) {

        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataItem<span class="operator">&gt;</span> <span class="operator">*</span>newResults <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>
                bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataItem<span class="operator">&gt;</span>;
        <span class="type">int</span> count <span class="operator">=</span> results<span class="operator">-</span><span class="operator">&gt;</span>size();
        <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> count; i<span class="operator">+</span><span class="operator">+</span>) {
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span> map <span class="operator">=</span> (<span class="operator">*</span>results)<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>payload()<span class="operator">.</span>toMap();
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> dataQuality <span class="operator">=</span> map<span class="operator">[</span><span class="string">&quot;data_quality&quot;</span><span class="operator">]</span><span class="operator">.</span>toString();
            <span class="comment">// Check the quality field value, and inject the proper image file based on the value found.</span>
            <span class="keyword">if</span> (dataQuality <span class="operator">=</span><span class="operator">=</span> <span class="string">&quot;Correct&quot;</span> <span class="operator">|</span><span class="operator">|</span> dataQuality <span class="operator">=</span><span class="operator">=</span> <span class="string">&quot;Complete and Correct&quot;</span>) {
                map<span class="operator">[</span><span class="string">&quot;dataQualityImage&quot;</span><span class="operator">]</span> <span class="operator">=</span> <span class="string">&quot;data_correct.png&quot;</span>;
            } <span class="keyword">else</span> {
                map<span class="operator">[</span><span class="string">&quot;dataQualityImage&quot;</span><span class="operator">]</span> <span class="operator">=</span> <span class="string">&quot;data_incorrect.png&quot;</span>;
            }
            <span class="comment">// Save the newly processed data.</span>
            (<span class="operator">*</span>results)<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>setPayload(map);
            newResults<span class="operator">-</span><span class="operator">&gt;</span>append((<span class="operator">*</span>results)<span class="operator">[</span>i<span class="operator">]</span>);
        }
        results <span class="operator">=</span> newResults;
    }</pre>
<p>This method creates a new <a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a> of <tt>DataItem</tt>'s, where the DataItem <a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a> is injected with additional data specifying the image name to represent it's data quality value. Afterwards, the DataItem payload is reset to the map containing the additional data and the list of DataItems replaces the old list.</p>
<a name="the-dataqualitymodeldecorator-class"></a>
<h2>The DataQualityModelDecorator class</h2>
<p>This class is meant to be chained with the DataQualityDataQueryDecorator class, changing the item type to correspond to the defined <tt>ListItemComponent</tt> for that type, which is specifically designed for that data layout.</p>
<pre class="cpp">    <span class="keyword">class</span> DataQualityModelDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator {
        Q_OBJECT

    <span class="keyword">public</span>:
        DataQualityModelDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">*</span> parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>DataQualityModelDecorator();

        <span class="comment">/**
         * Overwritten function to perform special type processing.
         *
         * @see DataModelDecorator
         */</span>
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);
    };
    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> DataQualityModelDecorator<span class="operator">::</span>itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(
                indexPath);
        <span class="keyword">if</span> (data<span class="operator">.</span>isValid()) {
            <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;dataQualityDecorated&quot;</span>);
        }
        <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;&quot;</span>);
    }</pre>
<a name="the-expandabledatamodeldecorator-class"></a>
<h2>The ExpandableDataModelDecorator class</h2>
<p>This class creates an expandable header model, allowing the user to display the headers at first and allowing to expand the header items when needed for more granular detail.</p>
<pre class="cpp">    <span class="keyword">class</span> ExpandableDataModelDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator {
        Q_OBJECT

    <span class="keyword">public</span>:
        ExpandableDataModelDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">*</span> parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>ExpandableDataModelDecorator();

        <span class="comment">/*
         * Inject &quot;expanded&quot; data value to true or false depending
         * if the data index equals the expanded index.
         * Call the method data of the DataModel it wraps.
         *
         * @see DataModel
         */</span>

        Q_INVOKABLE <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">/**
         * This method returns none zero children count only when the
         * selected index equals the expand index.
         * Call the method childCount of the DataModel it wraps.
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type">int</span> childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);

        <span class="comment">/*
         * This method confirms child count only at time when selected
         * index equals that of the expand index.
         * Call the method hasChildren of the DataModel it wraps.
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type">bool</span> hasChildren(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath);

    <span class="keyword">public</span> Q_SLOTS:

        <span class="comment">// This method toggles expanding or collapsing of header items.</span>
        <span class="comment">// It sets the expanded index and emits itemsChanged signal once the</span>
        <span class="comment">// index has been set to expand or collapse.</span>
        <span class="type">void</span> expandHeader(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath<span class="operator">,</span> <span class="type">bool</span> expand);

    <span class="keyword">private</span>:
        <span class="comment">// Sets the index to collapse or expand.</span>
        <span class="type">int</span> m_expandedIndex;

        <span class="comment">// This is a helper method to verify index path correctness, and whether the</span>
        <span class="comment">// index is expandable or not(already expanded).</span>
        <span class="type">bool</span> isExpandable(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) <span class="keyword">const</span>;
    };</pre>
<p>Inside the data() method we test again whether the data for a header item or a normal item are requested. For a header item we want to enrich the original data (the color of the container background) with the current expansion state. We use a <tt>QVariantMap</tt> for this purpose, add a &quot;expanded&quot; entry with the original data from the source model with a boolean value.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> ExpandableDataModelDecorator<span class="operator">::</span>data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(
                indexPath);
        <span class="keyword">if</span> (data<span class="operator">.</span>isValid()) {
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span> map <span class="operator">=</span> data<span class="operator">.</span>value<span class="operator">&lt;</span><span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span><span class="operator">&gt;</span>();
            <span class="keyword">if</span> (indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span>) {
                map<span class="operator">[</span><span class="string">&quot;expanded&quot;</span><span class="operator">]</span> <span class="operator">=</span> (indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">=</span><span class="operator">=</span> m_expandedIndex);
            }
            <span class="keyword">return</span> map;
        }
        <span class="keyword">return</span> data;
    }</pre>
<p>The following methods manipulate item child count based on whether the item is set for expansion or not. If item is not to be expanded (i.e&#x2e; not matching expand index) than the child count is set to zero, otherwise the real child count is returned. If the return is '0' the <tt>ListView</tt> won't show any child items underneath this header item. In all other cases, we simply forward the call to the source model.</p>
<pre class="cpp">    <span class="type">bool</span> ExpandableDataModelDecorator<span class="operator">::</span>isExpandable(
            <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) <span class="keyword">const</span> {
        <span class="keyword">return</span> indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span> <span class="operator">&amp;</span><span class="operator">&amp;</span> indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toInt() <span class="operator">!</span><span class="operator">=</span> m_expandedIndex;
    }

    <span class="type">int</span> ExpandableDataModelDecorator<span class="operator">::</span>childCount(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="keyword">if</span> (isExpandable(indexPath)) {
            <span class="keyword">return</span> <span class="number">0</span>;
        }
        <span class="keyword">return</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>childCount(indexPath);
    }

    <span class="type">bool</span> ExpandableDataModelDecorator<span class="operator">::</span>hasChildren(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="keyword">if</span> (isExpandable(indexPath)) {
            <span class="keyword">return</span> <span class="keyword">false</span>;
        }
        <span class="keyword">return</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>hasChildren(indexPath);
    }</pre>
<p>The expandHeader() method is a Qml invokable function, which sets the expand index to the current index if item is to be expanded or resets it to default value if item is already expanded and is to be collapsed.</p>
<pre class="cpp">    <span class="type">void</span> ExpandableDataModelDecorator<span class="operator">::</span>expandHeader(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath<span class="operator">,</span>
            <span class="type">bool</span> expand) {
        <span class="keyword">if</span> (indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span> <span class="operator">&amp;</span><span class="operator">&amp;</span> expand) {
            <span class="type">int</span> index <span class="operator">=</span> indexPath<span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">.</span>toInt();
            <span class="keyword">if</span> (index <span class="operator">=</span><span class="operator">=</span> m_expandedIndex) {
                m_expandedIndex <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span>;
                <span class="keyword">emit</span> itemsChanged(bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModelChangeType<span class="operator">::</span>AddRemove);
            } <span class="keyword">else</span> {
                m_expandedIndex <span class="operator">=</span> index;
                <span class="keyword">emit</span> itemsChanged(bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModelChangeType<span class="operator">::</span>AddRemove);
            }
        }
    }</pre>
<a name="the-groupartistdatamodeldecorator-class"></a>
<h2>The GroupArtistDataModelDecorator class</h2>
<p>This class changes the ListItemComponent type based on the data field value for &quot;is_group&quot;. If the value is true, than the type is changed to display a custom data layout defined for that item type.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> GroupArtistDataModelDecorator<span class="operator">::</span>itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(
                indexPath);
        <span class="keyword">if</span> (data<span class="operator">.</span>isValid()) {
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span> map <span class="operator">=</span> data<span class="operator">.</span>value<span class="operator">&lt;</span><span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span><span class="operator">&gt;</span>();
            <span class="type">int</span> isGroup <span class="operator">=</span> map<span class="operator">[</span><span class="string">&quot;is_group&quot;</span><span class="operator">]</span><span class="operator">.</span>toInt();
            <span class="comment">// Verifies that this data item is of group and returns the new type.</span>
            <span class="keyword">if</span> (isGroup) {
                <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;group&quot;</span>);
            }
        }
        <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;&quot;</span>);
    }</pre>
<a name="the-groupstyledataquerydecorator-class"></a>
<h2>The GroupStyleDataQueryDecorator class</h2>
<p>This class performs grouping of header items, resulting in all those items with similarly named headers to appear under one header.</p>
<pre class="cpp">    <span class="keyword">class</span> GroupStyleDataQueryDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataQueryDecorator {
        Q_OBJECT

    <span class="keyword">public</span>:
        GroupStyleDataQueryDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span><span class="operator">*</span> parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>GroupStyleDataQueryDecorator();

        <span class="comment">/**
         * Helper method to test if the given headers can be grouped.
         * Returns true if names are equal, and false otherwise.
         */</span>
        <span class="type">bool</span> isGroupable(bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem <span class="operator">&amp;</span>data<span class="operator">,</span>
                <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>title);

        <span class="comment">/**
         * This method compares the header names and resets the header child count
         * as a sum of similarly named header child counts.
         * Overwritten function to perform special processing on the header results.
         *
         * @see DataQueryDecorator
         */</span>
        <span class="keyword">virtual</span> <span class="type">void</span> processHeaderResults(
                <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem<span class="operator">&gt;</span><span class="operator">*</span> headerResults);

    };</pre>
<p>The following method is a helper function to determine if the given <tt>HeaderDataItem</tt>'s header title is the same as the given header title for comparison.</p>
<pre class="cpp">    <span class="type">bool</span> GroupStyleDataQueryDecorator<span class="operator">::</span>isGroupable(
            bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem <span class="operator">&amp;</span>data<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> <span class="operator">&amp;</span>title) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> payload <span class="operator">=</span> data<span class="operator">.</span>payload();
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> header <span class="operator">=</span> payload<span class="operator">.</span>toMap()<span class="operator">[</span><span class="string">&quot;header&quot;</span><span class="operator">]</span><span class="operator">.</span>toString();
        <span class="comment">// return result of header name equality test</span>
        <span class="keyword">return</span> header <span class="operator">=</span><span class="operator">=</span> title;
    }</pre>
<p>The processHeaderResults() method is a re-implementation of it's base class counterpart in order to give it the grouping capability. It traverses the header results, each item's header title is compared to the title of the next element, if both titles are found to be the same than their child counts are combined under one HeaderDataItem. This simplifies the data in the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> by aggregating all items with similar headers under one header, creating a leaner list that reduces the amount of scrolling one has to do.</p>
<pre class="cpp">    <span class="type">void</span> GroupStyleDataQueryDecorator<span class="operator">::</span>processHeaderResults(
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem<span class="operator">&gt;</span><span class="operator">*</span> headerResults) {

        <span class="comment">// The new header results list which will contain the grouped headers.</span>
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem<span class="operator">&gt;</span> <span class="operator">*</span>groupedResults <span class="operator">=</span>
                <span class="keyword">new</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qlist.html">QList</a></span><span class="operator">&lt;</span>bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>HeaderDataItem<span class="operator">&gt;</span>;
        <span class="type">int</span> count <span class="operator">=</span> headerResults<span class="operator">-</span><span class="operator">&gt;</span>size();
        <span class="keyword">for</span> (<span class="type">int</span> i <span class="operator">=</span> <span class="number">0</span>; i <span class="operator">&lt;</span> count; <span class="operator">+</span><span class="operator">+</span>i) {
            <span class="comment">//bb::cascades::datamanager::HeaderDataItem groupItem =</span>
            <span class="comment">//        ((*headerResults)[i]);</span>
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> title <span class="operator">=</span> ((<span class="operator">*</span>headerResults)<span class="operator">[</span>i<span class="operator">]</span>)<span class="operator">.</span>payload()<span class="operator">.</span>toMap()<span class="operator">[</span><span class="string">&quot;header&quot;</span><span class="operator">]</span><span class="operator">.</span>toString();
            <span class="type">int</span> groupCount <span class="operator">=</span> <span class="number">0</span>;
            <span class="comment">// Sum up child counts as long as headers are equal in name and within the list size.</span>
            <span class="keyword">do</span> {
                groupCount <span class="operator">+</span><span class="operator">=</span> (<span class="operator">*</span>headerResults)<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>childCount();
            } <span class="keyword">while</span> ((i <span class="operator">+</span> <span class="number">1</span>) <span class="operator">&lt;</span> count <span class="operator">&amp;</span><span class="operator">&amp;</span> isGroupable((<span class="operator">*</span>headerResults)<span class="operator">[</span>i <span class="operator">+</span> <span class="number">1</span><span class="operator">]</span><span class="operator">,</span> title)
                    <span class="operator">&amp;</span><span class="operator">&amp;</span> <span class="operator">+</span><span class="operator">+</span>i);
            <span class="comment">// Set the new child count of the grouped items and add it to the new list.</span>
            (<span class="operator">*</span>headerResults)<span class="operator">[</span>i<span class="operator">]</span><span class="operator">.</span>setChildCount(groupCount);
            groupedResults<span class="operator">-</span><span class="operator">&gt;</span>append((<span class="operator">*</span>headerResults)<span class="operator">[</span>i<span class="operator">]</span>);
        }
        headerResults <span class="operator">=</span> groupedResults;
    }</pre>
<a name="the-selectiondatamodeldecorator-class"></a>
<h2>The SelectionDataModelDecorator class</h2>
<p>This class enriches the user interaction of the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a>, by giving it a new functionality - the ability to select multiple items.</p>
<pre class="cpp">    <span class="keyword">class</span> SelectionDataModelDecorator: <span class="keyword">public</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator {
        Q_OBJECT

    <span class="keyword">public</span>:
        SelectionDataModelDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> <span class="number">0</span>);
        <span class="keyword">virtual</span> <span class="operator">~</span>SelectionDataModelDecorator();

        <span class="comment">/*!
         * Call the method data of the DataModel being decorated.
         *
         * @see DataModel
         */</span>
        Q_INVOKABLE <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

        <span class="comment">// This method clears the selection data set.</span>
        Q_INVOKABLE <span class="type">void</span> clearSelections();

        <span class="comment">/*!
         * Call the method itemType of the DataModel being decorated.
         *
         * @see DataModel
         */</span>
        <span class="keyword">virtual</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> <span class="operator">&amp;</span>indexPath);

    <span class="keyword">public</span> Q_SLOTS:
        <span class="comment">// This method adds or removes the item id from the selection set.</span>
        <span class="type">void</span> changeSelection(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> indexPath<span class="operator">,</span> <span class="type">bool</span> selected);

    <span class="keyword">private</span>:

        <span class="comment">// The set that tracks all the selected item id's</span>
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qset.html">QSet</a></span><span class="operator">&lt;</span><span class="type">int</span><span class="operator">&gt;</span> m_selectedSet;

        <span class="comment">// The internal hightlight color</span>
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> m_highlight;
    };</pre>
<p>The most important members of this class is the <a href="http://qt.nokia.com/doc/4.7/qset.html">QSet</a> which holds all the highlighted indexes, and the changeSelection() slot which adds or removes the index from the set based on whether it has already been selected or not. This enriches the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a> functionality by providing the ability for multi-item-selections.</p>
<pre class="cpp">    SelectionDataModelDecorator<span class="operator">::</span>SelectionDataModelDecorator(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qobject.html">QObject</a></span> <span class="operator">*</span>parent)
        : m_highlight(<span class="string">&quot;#36D986&quot;</span>) <span class="comment">// default greenish hue</span>
    {
    }</pre>
<p>The constructor initializes the default selection highlight color.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> SelectionDataModelDecorator<span class="operator">::</span>data(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(indexPath);
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span> map <span class="operator">=</span> data<span class="operator">.</span>value<span class="operator">&lt;</span><span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span><span class="operator">&gt;</span>();
        <span class="keyword">if</span> (indexPath<span class="operator">.</span>size() <span class="operator">=</span><span class="operator">=</span> <span class="number">1</span> <span class="operator">&amp;</span><span class="operator">&amp;</span> data<span class="operator">.</span>isValid()) {
            <span class="comment">// Inject the highlight color into the items data if item is selected.</span>
            map<span class="operator">[</span><span class="string">&quot;selected&quot;</span><span class="operator">]</span> <span class="operator">=</span>
                    m_selectedSet<span class="operator">.</span>contains(map<span class="operator">[</span><span class="string">&quot;id&quot;</span><span class="operator">]</span><span class="operator">.</span>toInt()) <span class="operator">?</span>
                            m_highlight : <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;#000000&quot;</span>); <span class="comment">//defaults to black</span>
        }
        <span class="keyword">return</span> map;
    }</pre>
<p>Inside the data() method we test again whether the data for a header item or a normal item are requested. We want to enrich the original data with the color of the container(ListItemComponent) background. We use a <tt>QVariantMap</tt> for this purpose, add a &quot;selected&quot; entry with the original data from the source model with a color hex value, this allows us to visually indicate which items have been selected by grouping them using the same color.</p>
<pre class="cpp">    <span class="type">void</span> SelectionDataModelDecorator<span class="operator">::</span>clearSelections() {
        m_selectedSet<span class="operator">.</span>clear();
        <span class="comment">// emit signal to refresh all item data after clearing selection set.</span>
        <span class="keyword">emit</span> itemsChanged(bb<span class="operator">::</span>cascades<span class="operator">::</span>DataModelChangeType<span class="operator">::</span>Update);
    }</pre>
<p>The clearSelection() method removes all indexes from the selected set, which in turn returns the item containers back to their original color upon emitting itemsChanged() signal to the <a href="http://qt.nokia.com/doc/4.7/qml-listview.html">ListView</a>.</p>
<pre class="cpp">    <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span> SelectionDataModelDecorator<span class="operator">::</span>itemType(<span class="keyword">const</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span><span class="operator">&amp;</span> indexPath) {
        <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(indexPath);
        <span class="keyword">if</span> (data<span class="operator">.</span>isValid()) {
            <span class="comment">// Identify these items as ListItemComponents of type &quot;selectable&quot;</span>
            <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;selectable&quot;</span>);
        }
        <span class="keyword">return</span> <span class="type"><a href="http://qt.nokia.com/doc/4.7/qstring.html">QString</a></span>(<span class="string">&quot;&quot;</span>);
    }</pre>
<p>The itemType() method changes the type to be of type 'selectable', which corresponds to the ListItemComponent of that type, that has the logic to deal with the additional data in order to show visually multiple selection functionality.</p>
<pre class="cpp">    <span class="type">void</span> SelectionDataModelDecorator<span class="operator">::</span>changeSelection(<span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantList-typedef">QVariantList</a></span> indexPath<span class="operator">,</span>
            <span class="type">bool</span> selected) {
        <span class="keyword">if</span> (selected) {
            <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html">QVariant</a></span> data <span class="operator">=</span> bb<span class="operator">::</span>cascades<span class="operator">::</span>datamanager<span class="operator">::</span>DataModelDecorator<span class="operator">::</span>data(indexPath);
            <span class="keyword">if</span> (data<span class="operator">.</span>isValid()) {
                <span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span> map <span class="operator">=</span> data<span class="operator">.</span>value<span class="operator">&lt;</span><span class="type"><a href="http://qt.nokia.com/doc/4.7/qvariant.html#QVariantMap-typedef">QVariantMap</a></span><span class="operator">&gt;</span>();
                <span class="type">int</span> id <span class="operator">=</span> map<span class="operator">[</span><span class="string">&quot;id&quot;</span><span class="operator">]</span><span class="operator">.</span>toInt();
                <span class="comment">// Check whether item already selected, if not add to selection se</span>
                <span class="comment">// otherwise remove(unselect) from the set.</span>
                <span class="keyword">if</span> (<span class="operator">!</span>m_selectedSet<span class="operator">.</span>contains(id)) {
                    m_selectedSet<span class="operator">.</span>insert(id);
                } <span class="keyword">else</span> {
                    m_selectedSet<span class="operator">.</span>remove(id);
                }
                <span class="comment">// emit signal to refresh item data</span>
                <span class="keyword">emit</span> itemUpdated(indexPath);
            }
        }
    }</pre>
<p>The changeSelection() method retrieves the selected data item and it's &quot;id&quot;, it than verifies if this &quot;id&quot; is in the set of selected items, and is either added or removed into the set depending on it's existence in the set. Afterwards, the itemUpdated() signal is emited, causing the data() method to be called, which in turn changes the items container background to indicate a selection or not pending if it's in the selection set.</p>
</div>
<!-- @@@listdecorators -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
