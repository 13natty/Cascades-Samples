<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- custommapview.qdoc -->
  <title>Cascades : Custom Map View Example</title>
  <link rel="stylesheet" type="text/css" href="style/offline.css" />
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="content"> 
    <a href="index.html" class="qtref"><span>Qt-based BB10 API Examples Documentation</span></a>
  </div>
  <div class="breadcrumb toolblock">
    <ul>
      <li class="first"><a href="index.html">Home</a></li>
      <!--  Breadcrumbs go here -->
<li><a href="http://qt.nokia.com/doc/4.7/all-examples.html">Examples</a></li>
<li>Custom Map View Example</li>
    </ul>
  </div>
</div>
<div class="content mainContent">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#overview">Overview</a></li>
<li class="level1"><a href="#the-ui">The UI</a></li>
</ul>
</div>
<h1 class="title">Custom Map View Example</h1>
<span class="subtitle"></span>
<!-- $$$custommapview-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="custommapview-precompiled-h.html">custommapview/precompiled.h</a></li>
<li><a href="custommapview-assets-bubble-qml.html">custommapview/assets/Bubble.qml</a></li>
<li><a href="custommapview-assets-main-qml.html">custommapview/assets/main.qml</a></li>
<li><a href="custommapview-assets-pin-qml.html">custommapview/assets/pin.qml</a></li>
<li><a href="custommapview-src-custommapview-cpp.html">custommapview/src/Custommapview.cpp</a></li>
<li><a href="custommapview-src-custommapview-hpp.html">custommapview/src/Custommapview.hpp</a></li>
<li><a href="custommapview-src-mapviewdemo-cpp.html">custommapview/src/MapViewDemo.cpp</a></li>
<li><a href="custommapview-src-mapviewdemo-hpp.html">custommapview/src/MapViewDemo.hpp</a></li>
<li><a href="custommapview-src-main-cpp.html">custommapview/src/main.cpp</a></li>
<li><a href="custommapview-custommapview-pro.html">custommapview/custommapview.pro</a></li>
<li><a href="custommapview-translations-custommapview-pro.html">custommapview/translations/custommapview.pro</a></li>
</ul>
<a name="description"></a>
<h2>Description</h2>
<p>The Custom Map View example displays a city map overlayed with three sliders that allow you to control altitude, tilt and heading. On top of this it demonstrates its main feature, which is the ability to put an overlay on another control and draw Controls on top of that.</p>
<p class="centerAlign"><img src="images/custommapview-example.png" /></p><p class="centerAlign"><img src="images/custommapview-example1.png" /></p><p class="centerAlign"><img src="images/custommapview-example2.png" /></p><a name="overview"></a>
<h2>Overview</h2>
<p>In this example we'll learn how to use the <tt>MapView</tt> class of the BB10 framework to change altitude, tilt and heading as well as dropping push pins using an overlay.</p>
<a name="the-ui"></a>
<h2>The UI</h2>
<p>The UI of this sample application consists of a page with a MapView, three slidders and several actions such as &quot;Drop Pin&quot;, &quot;Remove Pins&quot;, and some geographical location choices.</p>
<pre class="qml">    <span class="type">ActionItem</span> {
        <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Drop Pin&quot;</span>)
        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/pin.png&quot;</span>
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
        <span class="name">onTriggered</span>: {
            var <span class="name">marker</span> = <span class="name">pin</span>.<span class="name">createObject</span>();
            <span class="name">marker</span>.<span class="name">lat</span> <span class="operator">=</span> <span class="name">mapview</span>.<span class="name">latitude</span>;
            <span class="name">marker</span>.<span class="name">lon</span> <span class="operator">=</span> <span class="name">mapview</span>.<span class="name">longitude</span>;
            var <span class="name">xy</span> = <span class="name">mapViewTest</span>.<span class="name">worldToPixel</span>(<span class="name">mapview</span>, <span class="name">marker</span>.<span class="name">lat</span>, <span class="name">marker</span>.<span class="name">lon</span>);
            <span class="comment">// 36, 65 is the position of the pixel in pin.png that should point to the location.</span>
            <span class="name">marker</span>.<span class="name">x</span> <span class="operator">=</span> <span class="name">xy</span>.<span class="name">split</span>(<span class="string">&quot; &quot;</span>)[<span class="number">0</span>] <span class="operator">-</span> <span class="number">36</span>;
            <span class="name">marker</span>.<span class="name">y</span> <span class="operator">=</span> <span class="name">xy</span>.<span class="name">split</span>(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>] <span class="operator">-</span> <span class="number">65</span>;
            <span class="name">pinContainer</span>.<span class="name">add</span>(<span class="name">marker</span>);
            <span class="name">marker</span>.<span class="name">anim</span>.<span class="name">play</span>();
        }
    },
    <span class="type">ActionItem</span> {
        <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Ramove Pins&quot;</span>)
        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/clearpin.png&quot;</span>
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
        <span class="name">onTriggered</span>: {
            <span class="name">pinContainer</span>.<span class="name">removeAll</span>();
        }
    },
    <span class="type">ActionItem</span> {
        <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Center URL&quot;</span>)
        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/url.png&quot;</span>
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">OnBar</span>
        <span class="name">onTriggered</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="name">mapview</span>.<span class="name">url</span>());
        }
    },
    <span class="type">ActionItem</span> {
        <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Waterloo&quot;</span>)
        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/pin.png&quot;</span>
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">InOverflow</span>
        <span class="name">onTriggered</span>: {
            <span class="name">mapview</span>.<span class="name">latitude</span> <span class="operator">=</span> <span class="number">43.468245</span>;
            <span class="name">mapview</span>.<span class="name">longitude</span> <span class="operator">=</span> -<span class="number">80.519603</span>;
        }
    },
    <span class="type">ActionItem</span> {
        <span class="name">title</span>: <span class="name">qsTr</span>(<span class="string">&quot;Manhattan&quot;</span>)
        <span class="name">imageSource</span>: <span class="string">&quot;asset:///images/pin.png&quot;</span>
        <span class="name">ActionBar</span>.placement: <span class="name">ActionBarPlacement</span>.<span class="name">InOverflow</span>
        <span class="name">onTriggered</span>: {
            <span class="name">mapview</span>.<span class="name">latitude</span> <span class="operator">=</span> <span class="number">40.791556</span>;
            <span class="name">mapview</span>.<span class="name">longitude</span> <span class="operator">=</span> -<span class="number">73.967394</span>;
        }
    }</pre>
<p>These actions provide ways to manipulate the map view by dropping pins, clearing them or going to a specific location such as Manhattan. These manipulations are done through longitude, latitude and x,y calculations to drop them in the user tapped area. The current way might seem complicated, but its only a temporary workaround for the pin functionality that will be available as part of the MapView element coming soon.</p>
<pre class="qml">    <span class="keyword">function</span> <span class="name">updateMarkers</span>() {
        <span class="keyword">for</span> (<span class="keyword">var</span> <span class="name">i</span> = <span class="number">0</span>; <span class="name">i</span> <span class="operator">&lt;</span> <span class="name">pinContainer</span>.<span class="name">count</span>(); i ++) {
            var <span class="name">xy</span> = <span class="name">mapViewTest</span>.<span class="name">worldToPixel</span>(<span class="name">mapview</span>, <span class="name">pinContainer</span>.<span class="name">at</span>(<span class="name">i</span>).<span class="name">lat</span>, <span class="name">pinContainer</span>.<span class="name">at</span>(<span class="name">i</span>).<span class="name">lon</span>);
            <span class="comment">// 36, 65 is the position of the pixel in pin.png that should point to the location.</span>
            <span class="name">pinContainer</span>.<span class="name">at</span>(<span class="name">i</span>).<span class="name">x</span> <span class="operator">=</span> <span class="name">xy</span>.<span class="name">split</span>(<span class="string">&quot; &quot;</span>)[<span class="number">0</span>] <span class="operator">-</span> <span class="number">36</span>;
            <span class="name">pinContainer</span>.<span class="name">at</span>(<span class="name">i</span>).<span class="name">y</span> <span class="operator">=</span> <span class="name">xy</span>.<span class="name">split</span>(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>] <span class="operator">-</span> <span class="number">65</span>;
        }
    }
    <span class="name">layout</span>: <span class="name">DockLayout</span> {
    }
    <span class="type">MapView</span> {
        <span class="name">id</span>: <span class="name">mapview</span>
        <span class="name">altitude</span>: <span class="number">3000</span>
        <span class="name">latitude</span>: <span class="number">43.449488</span>
        <span class="name">longitude</span>: -<span class="number">80.406777</span>
        <span class="name">preferredWidth</span>: <span class="number">768</span>
        <span class="name">preferredHeight</span>: <span class="number">1280</span>
        <span class="name">onAltitudeChanged</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;altitudeChanged: &quot;</span> <span class="operator">+</span> <span class="name">newAlt</span>);
        }
        <span class="name">onHeadingChanged</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;headingChanged: &quot;</span> <span class="operator">+</span> <span class="name">newHeading</span>);
        }
        <span class="name">onLatitudeChanged</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;latitudeChanged: &quot;</span> <span class="operator">+</span> <span class="name">newLat</span>);
        }
        <span class="name">onLongitudeChanged</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;longitudeChanged: &quot;</span> <span class="operator">+</span> <span class="name">newLon</span>);
        }
        <span class="name">onTiltChanged</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;tiltChanged: &quot;</span> <span class="operator">+</span> <span class="name">newTilt</span>);
        }
        <span class="name">onMapLongPressed</span>: {
            <span class="name">status</span>.<span class="name">setText</span>(<span class="string">&quot;mapLongPress: &quot;</span>);
        }
        <span class="name">onRequestRender</span>: {
            <span class="name">root</span>.<span class="name">updateMarkers</span>();
        }
    }</pre>
<p>The MapView element is set to the Waterloo, Ontario latitude,longitude location by default. The markers (Pin locations) x,y positions are updated by invoking the updateMarkers javascript method, whenever the onAltitudeChanged, onLatitudeChanged and onLongitudeChanged signals are generated.</p>
<pre class="qml">    <span class="type">Label</span> {
        <span class="name">id</span>: <span class="name">status</span>
        <span class="name">multiline</span>: <span class="number">true</span>
        <span class="type">textStyle</span> {
            <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">SmallText</span>
            <span class="name">color</span>: <span class="name">Color</span>.<span class="name">Red</span>
            <span class="name">fontWeight</span>: <span class="name">FontWeight</span>.<span class="name">Bold</span>
        }
    }</pre>
<p>Displays the status of the MapView element, such as current atlitude, tilt or latitude, longitude updates and some user actions.</p>
<pre class="qml">    <span class="type">Container</span> {
        <span class="name">leftPadding</span>: <span class="number">10</span>
        <span class="name">rightPadding</span>: <span class="number">10</span>
        <span class="name">bottomPadding</span>: <span class="number">10</span>
        <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
        <span class="name">verticalAlignment</span>: <span class="name">VerticalAlignment</span>.<span class="name">Bottom</span>
        <span class="name">layout</span>: <span class="name">StackLayout</span> {
        }
        <span class="type">Container</span> {
            <span class="name">layout</span>: <span class="name">StackLayout</span> {
                <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
            }
            <span class="type">Label</span> {
                <span class="type">textStyle</span> {
                    <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">SubtitleText</span>
                    <span class="name">color</span>: <span class="name">Color</span>.<span class="name">Blue</span>
                    <span class="name">fontWeight</span>: <span class="name">FontWeight</span>.<span class="name">Bold</span>
                    <span class="name">fontFamily</span>: <span class="string">&quot;courier&quot;</span>
                }
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.3</span>
                }
                <span class="name">id</span>: <span class="name">altitudeLabel</span>
                <span class="name">text</span>: <span class="string">&quot;Altitude&quot;</span>
            }
            <span class="type">Slider</span> {
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.7</span>
                }
                <span class="name">id</span>: <span class="name">altitudeSlider</span>
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                <span class="name">value</span>: <span class="number">2</span>
                <span class="name">fromValue</span>: <span class="number">500</span>
                <span class="name">toValue</span>: <span class="number">5000</span>
                <span class="name">onImmediateValueChanged</span>: {
                    <span class="name">mapview</span>.<span class="name">setAltitude</span>(<span class="name">Math</span>.<span class="name">round</span>(<span class="name">immediateValue</span>))
                    <span class="name">altitudeLabel</span>.<span class="name">setText</span>(<span class="string">&quot;Altitude: &quot;</span> <span class="operator">+</span> <span class="name">Math</span>.<span class="name">round</span>(<span class="name">mapview</span>.<span class="name">altitude</span>))
                }
                <span class="name">onValueChanged</span>: {
                }
            }
        }
        <span class="type">Container</span> {
            <span class="name">layout</span>: <span class="name">StackLayout</span> {
                <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
            }
            <span class="type">Label</span> {
                <span class="type">textStyle</span> {
                    <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">SubtitleText</span>
                    <span class="name">color</span>: <span class="name">Color</span>.<span class="name">Blue</span>
                    <span class="name">fontWeight</span>: <span class="name">FontWeight</span>.<span class="name">Bold</span>
                    <span class="name">fontFamily</span>: <span class="string">&quot;courier&quot;</span>
                }
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.3</span>
                }
                <span class="name">id</span>: <span class="name">tiltLabel</span>
                <span class="name">text</span>: <span class="string">&quot;Tilt&quot;</span>
            }
            <span class="type">Slider</span> {
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.7</span>
                }
                <span class="name">id</span>: <span class="name">tiltSlider</span>
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                <span class="name">fromValue</span>: <span class="number">0</span>
                <span class="name">toValue</span>: <span class="number">45</span>
                <span class="name">onImmediateValueChanged</span>: {
                    <span class="name">mapview</span>.<span class="name">setTilt</span>(<span class="name">Math</span>.<span class="name">round</span>(<span class="name">immediateValue</span>))
                    <span class="name">tiltLabel</span>.<span class="name">setText</span>(<span class="string">&quot;Tilt: &quot;</span> <span class="operator">+</span> <span class="name">mapview</span>.<span class="name">tilt</span> <span class="operator">+</span> <span class="string">&quot;\u00B0&quot;</span>)
                }
            }
        }
        <span class="type">Container</span> {
            <span class="name">layout</span>: <span class="name">StackLayout</span> {
                <span class="name">orientation</span>: <span class="name">LayoutOrientation</span>.<span class="name">LeftToRight</span>
            }
            <span class="type">Label</span> {
                <span class="type">textStyle</span> {
                    <span class="name">base</span>: <span class="name">SystemDefaults</span>.<span class="name">TextStyles</span>.<span class="name">SubtitleText</span>
                    <span class="name">color</span>: <span class="name">Color</span>.<span class="name">Blue</span>
                    <span class="name">fontWeight</span>: <span class="name">FontWeight</span>.<span class="name">Bold</span>
                    <span class="name">fontFamily</span>: <span class="string">&quot;courier&quot;</span>
                }
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.3</span>
                }
                <span class="name">id</span>: <span class="name">headingLabel</span>
                <span class="name">text</span>: <span class="string">&quot;Heading&quot;</span>
            }
            <span class="type">Slider</span> {
                <span class="name">layoutProperties</span>: <span class="name">StackLayoutProperties</span> {
                    <span class="name">spaceQuota</span>: <span class="number">.7</span>
                }
                <span class="name">id</span>: <span class="name">headingSlider</span>
                <span class="name">horizontalAlignment</span>: <span class="name">HorizontalAlignment</span>.<span class="name">Center</span>
                <span class="name">fromValue</span>: -<span class="number">180</span>
                <span class="name">toValue</span>: <span class="number">180</span>
                <span class="name">onImmediateValueChanged</span>: {
                    <span class="name">mapview</span>.<span class="name">setHeading</span>(<span class="name">Math</span>.<span class="name">round</span>(<span class="name">immediateValue</span>))
                    <span class="name">headingLabel</span>.<span class="name">setText</span>(<span class="string">&quot;Heading: &quot;</span> <span class="operator">+</span> <span class="name">mapview</span>.<span class="name">heading</span> <span class="operator">+</span> <span class="string">&quot;\u00B0&quot;</span>)
                }
            }
        }
    }</pre>
<p>The Container that encapsulates the three sliders that allow the user to change MapView altitude, tilt and map heading. As the user changes the sliders, their values get displayed in the status bar that was mentioned earlier. These are direct manipulations of the MapView element that provides all three of these functionalities.</p>
<p>After the construction of the <tt>MapView</tt> element, we enforce it to use the 3D rendering engine, since by default the 'Blank' rendering engine is used. Whenever the user clicks on the 'Back' button, the sheet is closed and the main page becomes visible again.</p>
<pre class="qml">    <span class="name">attachedObjects</span>: [
        <span class="type">ComponentDefinition</span> {
            <span class="name">id</span>: <span class="name">pin</span>
            <span class="name">source</span>: <span class="string">&quot;pin.qml&quot;</span>
        },
        <span class="type">ComponentDefinition</span> {
            <span class="name">id</span>: <span class="name">bubble</span>
            <span class="name">source</span>: <span class="string">&quot;bubble.qml&quot;</span>
        }
    ]</pre>
<p>These are component definitions of qml assets that allows for dynamic QML creation. In this case, it allows us to created predefined pin and bubble elements which represent the pin, bubble image assets respectively with scale transition for the pin custom element.</p>
</div>
<!-- @@@custommapview -->
  <div class="ft">
    <span></span>
  </div>
</div> 
<div class="footer">
  <p>
     Copyright 2012 Research In Motion Limited.
  <br />
    This document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
    Free Documentation License version 1.3</a>
    as published by the Free Software Foundation.</p>
</div>
</body>
</html>
